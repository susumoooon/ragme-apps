<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìä AIÂàÜÊûê - „Çπ„Ç≠„É´„ÉªÊÄùËÄÉÊßãÈÄ†ÂèØË¶ñÂåñ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #20b2aa;
            --primary-dark: #16a085;
            --secondary: #48d1cc;
            --accent: #06d6a0;
            --accent-dark: #05b08a;
            --warning: #f59e0b;
            --danger: #ef4444;
            --success: #10b981;
            
            --bg-primary: #0f0f23;
            --bg-secondary: #1a1a2e;
            --bg-tertiary: #16213e;
            --bg-card: rgba(255, 255, 255, 0.05);
            --bg-glass: rgba(255, 255, 255, 0.1);
            
            --text-primary: #ffffff;
            --text-secondary: #cbd5e1;
            --text-muted: #64748b;
            
            --border: rgba(255, 255, 255, 0.1);
            --border-focus: rgba(32, 178, 170, 0.5);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            background-attachment: fixed;
            color: #ffffff;
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            min-height: 100vh;
            overflow-x: auto;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 20%, rgba(32, 178, 170, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(72, 209, 204, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 60%, rgba(6, 214, 160, 0.05) 0%, transparent 50%);
            z-index: -1;
            animation: backgroundShift 20s ease-in-out infinite;
        }

        @keyframes backgroundShift {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
            padding: 1rem 0;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .nav-brand {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            text-decoration: none;
        }

        .nav-brand i {
            font-size: 1.8rem;
        }

        .nav-menu {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1rem;
            border-radius: 10px;
            color: var(--text-secondary);
            text-decoration: none;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .nav-link:hover {
            color: var(--primary);
            background: rgba(32, 178, 170, 0.1);
            transform: translateY(-2px);
        }

        .nav-link.active {
            color: var(--primary);
            background: rgba(32, 178, 170, 0.2);
            box-shadow: 0 0 20px rgba(32, 178, 170, 0.3);
        }

        .nav-link i {
            font-size: 1.1rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .username-display {
            color: var(--primary);
            font-weight: 600;
        }

        .logout-btn {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
            border: 1px solid var(--danger);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .logout-btn:hover {
            background: var(--danger);
            color: white;
        }

        .container {
            max-width: 1200px;
            margin: 80px auto 0;
            padding: 2rem;
        }
        .main-title {
            text-align: center;
            margin-bottom: 2rem;
        }
        .main-title h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, #20b2aa, #48d1cc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .main-title p {
            color: #cbd5e1;
            font-size: 1.1rem;
        }
        .analysis-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        .analysis-section:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: #20b2aa;
            transform: translateY(-2px);
        }
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        .section-title {
            font-size: 1.5rem;
            color: #20b2aa;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .action-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-secondary);
            border: 1px solid var(--border);
        }
        .btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
            transform: translateY(-2px);
        }
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        .status-indicator {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            color: var(--text-secondary);
        }
        .status-success {
            color: var(--text-secondary);
            border-left: 3px solid #10b981;
        }
        .status-warning {
            color: var(--text-secondary);
            border-left: 3px solid #f59e0b;
        }
        .status-error {
            color: var(--text-secondary);
            border-left: 3px solid #ef4444;
        }
        .status-info {
            color: var(--text-secondary);
            border-left: 3px solid #20b2aa;
        }
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 15px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .data-table th,
        .data-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .data-table th {
            background: rgba(255, 255, 255, 0.05);
            color: #20b2aa;
            font-weight: 600;
        }
        .data-table tr:hover {
            background: rgba(32, 178, 170, 0.1);
        }
        .skill-level {
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.8rem;
            font-weight: 600;
        }
        .level-beginner { background: rgba(245, 158, 11, 0.15); color: #f59e0b; }
        .level-intermediate { background: rgba(32, 178, 170, 0.15); color: #20b2aa; }
        .level-advanced { background: rgba(16, 185, 129, 0.15); color: #10b981; }
        .level-expert { background: rgba(139, 92, 246, 0.15); color: #8b5cf6; }
        .thinking-frequency {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .frequency-bar {
            width: 100px;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }
        .frequency-fill {
            height: 100%;
            background: linear-gradient(90deg, #20b2aa, #48d1cc);
            transition: width 0.3s ease;
        }
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #cbd5e1;
        }
        .empty-state h3 {
            margin-bottom: 1rem;
            color: #ffffff;
        }
        .loading {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        .spinner {
            width: 1rem;
            height: 1rem;
            border: 2px solid transparent;
            border-top: 2px solid currentColor;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @media (max-width: 768px) {
            .nav-container {
                padding: 0 1rem;
            }
            
            .nav-menu {
                gap: 0.5rem;
            }
            
            .nav-link span {
                display: none;
            }
            
            .container {
                padding: 1rem;
            }
            
            .main-title h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <i class="fas fa-robot"></i>
                <span>RAGme</span>
            </div>
            <div class="nav-menu">
                <a href="index.html" class="nav-link">
                    <i class="fas fa-home"></i>
                    <span>„Éõ„Éº„É†</span>
                </a>
                <a href="memory.html" class="nav-link">
                    <i class="fas fa-brain"></i>
                    <span>„É°„É¢„É™„Éº</span>
                </a>
                <a href="analysis.html" class="nav-link active">
                    <i class="fas fa-chart-line"></i>
                    <span>AIÂàÜÊûê</span>
                </a>
                <a href="settings.html" class="nav-link">
                    <i class="fas fa-cog"></i>
                    <span>Ë®≠ÂÆö</span>
                </a>
                <div class="user-info">
                    <span class="username-display" id="usernameDisplay"></span>
                    <button class="logout-btn" onclick="logoutUser()">
                        <i class="fas fa-sign-out-alt"></i> „É≠„Ç∞„Ç¢„Ç¶„Éà
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <main class="container">
        <div class="main-title">
            <h1><i class="fas fa-chart-line"></i> AIÂàÜÊûê</h1>
            <p>ÂÖ•Âäõ„Éá„Éº„Çø„Åã„Çâ„ÅÇ„Å™„Åü„ÅÆ„Çπ„Ç≠„É´„Å®ÊÄùËÄÉ„ÇíÂèØË¶ñÂåñ</p>
        </div>

        <!-- ÂàÜÊûêÂÆüË°å„Çª„ÇØ„Ç∑„Éß„É≥ -->
        <div class="analysis-section">
            <div class="section-header">
                <h2 class="section-title">
                    üîç AIÂàÜÊûêÂÆüË°å
                </h2>
                <div class="action-buttons">
                    <button class="btn" id="generateTestBtn">
                        üìÑ „ÉÜ„Çπ„Éà„Éá„Éº„ÇøÁîüÊàê
                    </button>
                    <button class="btn" id="startAnalysisBtn">
                        ü§ñ GPT-3.5ÂàÜÊûêÈñãÂßã
                    </button>
                </div>
            </div>
            
            <div id="statusIndicator" class="status-indicator status-info">
                üìä ÂàÜÊûê„ÇíÈñãÂßã„Åô„Çã„Å´„ÅØ„ÄÅ‰∏ä„ÅÆ„Éú„Çø„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶„Åè„Å†„Åï„ÅÑ
            </div>
        </div>

        <!-- „Çπ„Ç≠„É´ÂàÜÊûêÁµêÊûú -->
        <div class="analysis-section">
            <div class="section-header">
                <h2 class="section-title">
                    üí° „Çπ„Ç≠„É´ÂàÜÊûêÁµêÊûú
                </h2>
            </div>
            
            <div id="skillsTableContainer">
                <table class="data-table" id="skillsTable">
                    <thead>
                        <tr>
                            <th>„Çπ„Ç≠„É´Âêç</th>
                            <th>„É¨„Éô„É´</th>
                            <th>„Ç´„ÉÜ„Ç¥„É™</th>
                            <th>Ë™¨Êòé</th>
                            <th>È†ªÂ∫¶</th>
                        </tr>
                    </thead>
                    <tbody id="skillsTableBody">
                        <tr>
                            <td colspan="5" class="empty-state">
                                <h3>üìä ÂàÜÊûê„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</h3>
                                <p>AIÂàÜÊûê„ÇíÂÆüË°å„Åó„Å¶„Çπ„Ç≠„É´ÊÉÖÂ†±„ÇíË°®Á§∫„Åó„Åæ„Åô</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ÊÄùËÄÉËª∏ÂàÜÊûêÁµêÊûú -->
        <div class="analysis-section">
            <div class="section-header">
                <h2 class="section-title">
                    üß† ÊÄùËÄÉËª∏ÂàÜÊûêÁµêÊûú
                </h2>
            </div>
            
            <div id="thinkingTableContainer">
                <table class="data-table" id="thinkingTable">
                    <thead>
                        <tr>
                            <th>ÊÄùËÄÉËª∏Âêç</th>
                            <th>È†ªÂ∫¶</th>
                            <th>Ââ≤Âêà</th>
                            <th>Ë°åÂãï‰æã</th>
                        </tr>
                    </thead>
                    <tbody id="thinkingTableBody">
                        <tr>
                            <td colspan="4" class="empty-state">
                                <h3>üß† ÂàÜÊûê„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</h3>
                                <p>AIÂàÜÊûê„ÇíÂÆüË°å„Åó„Å¶ÊÄùËÄÉËª∏ÊÉÖÂ†±„ÇíË°®Á§∫„Åó„Åæ„Åô</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <script>
        // ÈÅÖÂª∂Ë™çË®º„ÉÅ„Çß„ÉÉ„ÇØÈñ¢Êï∞
        function checkAuthenticationDelayed() {
            const isAuthenticated = 
                sessionStorage.getItem('authenticated') === 'true' || 
                localStorage.getItem('authenticated') === 'true' ||
                (window.userManager && window.userManager.isLoggedIn());

            if (!isAuthenticated) {
                console.log('üîí Authentication failed, redirecting to login...');
                window.location.href = 'index.html';
                return false;
            }
            
            console.log('‚úÖ Authentication check passed');
            return true;
        }

        // Âç≥Â∫ß„ÅÆË™çË®º„ÉÅ„Çß„ÉÉ„ÇØÔºà„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÔºâ
        (function() {
            const isAuthenticated = 
                sessionStorage.getItem('authenticated') === 'true' || 
                localStorage.getItem('authenticated') === 'true';

            if (!isAuthenticated) {
                console.log('üîí No authentication found, redirecting to login...');
                window.location.href = 'index.html';
                return;
            }
            
            console.log('‚úÖ Basic authentication check passed');
        })();

        // OpenAI API„Ç≠„ÉºÔºàÂÆüÈöõ„ÅÆ„Ç≠„Éº„Å´ÁΩÆ„ÅçÊèõ„Åà„Å¶„Åè„Å†„Åï„ÅÑÔºâ
        const OPENAI_API_KEY = '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';
        
        // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞
        let currentUser = '';
        let memoriesData = [];
        let analysisData = null;
        let isAnalyzing = false;

        // DOMË¶ÅÁ¥†
        const statusIndicator = document.getElementById('statusIndicator');
        const generateTestBtn = document.getElementById('generateTestBtn');
        const startAnalysisBtn = document.getElementById('startAnalysisBtn');
        const skillsTableBody = document.getElementById('skillsTableBody');
        const thinkingTableBody = document.getElementById('thinkingTableBody');

        // „Éö„Éº„Ç∏ÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            initializePage();
            loadExistingData();
        });

        // „Éö„Éº„Ç∏ÂàùÊúüÂåñ
        function initializePage() {
            // Ë™çË®º„ÉÅ„Çß„ÉÉ„ÇØ„ÇíÂÖà„Å´ÂÆüË°å
            if (!checkAuthenticationDelayed()) {
                return;
            }

            // „É¶„Éº„Ç∂„ÉºË™çË®º„ÉÅ„Çß„ÉÉ„ÇØ
            currentUser = localStorage.getItem('currentUser') || sessionStorage.getItem('username');
            if (!currentUser && window.userManager) {
                const user = window.userManager.getCurrentUser();
                if (user) {
                    currentUser = user.username;
                }
            }
            
            if (!currentUser) {
                console.log('üîí No user found, redirecting...');
                window.location.href = 'index.html';
                return;
            }

            // „É¶„Éº„Ç∂„ÉºÂêç„ÇíË°®Á§∫
            const usernameDisplay = document.getElementById('usernameDisplay');
            if (usernameDisplay) {
                usernameDisplay.textContent = currentUser;
            }

            // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºË®≠ÂÆö
            generateTestBtn.addEventListener('click', generateTestData);
            startAnalysisBtn.addEventListener('click', startAnalysis);

            updateStatus('info', 'üìä ÂàÜÊûêÊ∫ñÂÇôÂÆå‰∫Ü„ÄÇ„Éá„Éº„Çø„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
            console.log('‚úÖ Page initialization complete');
        }

        // Êó¢Â≠ò„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø
        function loadExistingData() {
            try {
                // „É°„É¢„É™„Éº„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø
                const savedMemories = localStorage.getItem('ragme_memories');
                if (savedMemories) {
                    memoriesData = JSON.parse(savedMemories);
                    updateStatus('success', `üìö „É°„É¢„É™„Éº„Éá„Éº„Çø ${memoriesData.length}‰ª∂„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü`);
                } else {
                    updateStatus('warning', '‚ö†Ô∏è „É°„É¢„É™„Éº„Éá„Éº„Çø„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„ÄÇ„ÉÜ„Çπ„Éà„Éá„Éº„Çø„ÇíÁîüÊàê„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                }

                // Êó¢Â≠ò„ÅÆÂàÜÊûêÁµêÊûú„ÅÆË™≠„ÅøËæº„Åø
                const savedAnalysis = localStorage.getItem('analysis_data');
                if (savedAnalysis) {
                    analysisData = JSON.parse(savedAnalysis);
                    displayAnalysisResults(analysisData);
                    updateStatus('success', '‚úÖ ‰øùÂ≠òÊ∏à„Åø„ÅÆÂàÜÊûêÁµêÊûú„ÇíË°®Á§∫„Åó„Åæ„Åó„Åü');
                }
            } catch (error) {
                console.error('„Éá„Éº„ÇøË™≠„ÅøËæº„Åø„Ç®„É©„Éº:', error);
                updateStatus('error', '‚ùå „Éá„Éº„ÇøË™≠„ÅøËæº„Åø‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü');
            }
        }

        // „ÉÜ„Çπ„Éà„Éá„Éº„ÇøÁîüÊàê
        function generateTestData() {
            const testMemories = [
                {
                    id: Date.now() + '-1',
                    timestamp: new Date().toISOString(),
                    content: 'React„ÅÆ„Ç≥„É≥„Éù„Éº„Éç„É≥„ÉàË®≠Ë®à„Å´„Å§„ÅÑ„Å¶Â≠¶Áøí„Åó„Åæ„Åó„Åü„ÄÇHooks„Çí‰Ωø„Å£„ÅüÁä∂ÊÖãÁÆ°ÁêÜ„ÅåÁêÜËß£„Åß„Åç„Çã„Çà„ÅÜ„Å´„Å™„Å£„Å¶„Åç„Å¶„ÅÑ„Åæ„Åô„ÄÇ',
                    type: 'text',
                    tags: ['„Éó„É≠„Ç∞„É©„Éü„É≥„Ç∞', 'Â≠¶Áøí']
                },
                {
                    id: Date.now() + '-2',
                    timestamp: new Date().toISOString(),
                    content: '„ÉÅ„Éº„É†„Éü„Éº„ÉÜ„Ç£„É≥„Ç∞„Åß„Éó„É≠„Ç∏„Çß„ÇØ„Éà„ÅÆÈÄ≤Êçó„ÇíÁ¢∫Ë™ç„ÄÇ„Çø„Çπ„ÇØ„ÅÆÂÑ™ÂÖàÈ†Ü‰Ωç„ÇíÊï¥ÁêÜ„Åó„ÄÅÂäπÁéáÁöÑ„Å™‰ΩúÊ•≠ÂàÜÊãÖ„ÇíÊ±∫„ÇÅ„Åæ„Åó„Åü„ÄÇ',
                    type: 'text',
                    tags: ['„Éû„Éç„Ç∏„É°„É≥„Éà', '‰ºöË≠∞']
                },
                {
                    id: Date.now() + '-3',
                    timestamp: new Date().toISOString(),
                    content: 'Ëã±Ë™û„ÅÆ„Éì„Ç∏„Éç„Çπ‰ºöË©±Á∑¥Áøí„ÄÇ„Éó„É¨„Çº„É≥„ÉÜ„Éº„Ç∑„Éß„É≥„Åß‰Ωø„Åà„ÇãË°®Áèæ„ÇíË¶ö„Åà„Å¶ÂÆüÈöõ„Å´‰Ωø„Å£„Å¶„Åø„Åæ„Åó„Åü„ÄÇ',
                    type: 'text',
                    tags: ['Ëã±Ë™ûÂ≠¶Áøí', '„Éó„É¨„Çº„É≥']
                },
                {
                    id: Date.now() + '-4',
                    timestamp: new Date().toISOString(),
                    content: '„Éá„Éº„Çø„Éô„Éº„ÇπË®≠Ë®à„ÅÆË™≤È°å„ÇíËß£Ê±∫„ÄÇ„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ„ÅÆÊúÄÈÅ©Âåñ„Å´„Çà„ÇäÂá¶ÁêÜÈÄüÂ∫¶„ÅåÂ§ßÂπÖ„Å´ÊîπÂñÑ„Åï„Çå„Åæ„Åó„Åü„ÄÇ',
                    type: 'text',
                    tags: ['„Éá„Éº„Çø„Éô„Éº„Çπ', 'ÊúÄÈÅ©Âåñ']
                },
                {
                    id: Date.now() + '-5',
                    timestamp: new Date().toISOString(),
                    content: 'Êñ∞„Åó„ÅÑ„Éû„Éº„Ç±„ÉÜ„Ç£„É≥„Ç∞Êà¶Áï•„Å´„Å§„ÅÑ„Å¶ÂàÜÊûê„ÄÇÈ°ßÂÆ¢„ÅÆ„Éã„Éº„Ç∫„ÇíÊ∑±„ÅèÁêÜËß£„Åô„ÇãÈáçË¶ÅÊÄß„ÇíÂÆüÊÑü„Åó„Åæ„Åó„Åü„ÄÇ',
                    type: 'text',
                    tags: ['„Éû„Éº„Ç±„ÉÜ„Ç£„É≥„Ç∞', 'ÂàÜÊûê']
                }
            ];

            try {
                localStorage.setItem('ragme_memories', JSON.stringify(testMemories));
                memoriesData = testMemories;
                updateStatus('success', `‚úÖ „ÉÜ„Çπ„Éà„Éá„Éº„Çø ${testMemories.length}‰ª∂„ÇíÁîüÊàê„Åó„Åæ„Åó„Åü`);
            } catch (error) {
                console.error('„ÉÜ„Çπ„Éà„Éá„Éº„ÇøÁîüÊàê„Ç®„É©„Éº:', error);
                updateStatus('error', '‚ùå „ÉÜ„Çπ„Éà„Éá„Éº„ÇøÁîüÊàê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            }
        }

        // AIÂàÜÊûêÈñãÂßã
        async function startAnalysis() {
            if (isAnalyzing) return;
            
            if (memoriesData.length === 0) {
                updateStatus('warning', '‚ö†Ô∏è ÂàÜÊûê„Åô„Çã„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇÂÖà„Å´„ÉÜ„Çπ„Éà„Éá„Éº„Çø„ÇíÁîüÊàê„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                return;
            }

            isAnalyzing = true;
            startAnalysisBtn.disabled = true;
            startAnalysisBtn.innerHTML = '<div class="loading"><div class="spinner"></div>ÂàÜÊûê‰∏≠...</div>';
            
            updateStatus('info', 'ü§ñ AIÂàÜÊûê„ÇíÈñãÂßã„Åó„Å¶„ÅÑ„Åæ„Åô...');

            try {
                let result;
                
                if (OPENAI_API_KEY && OPENAI_API_KEY !== 'YOUR_API_KEY_HERE') {
                    // GPT-3.5„Å´„Çà„ÇãÂàÜÊûê
                    result = await performGPTAnalysis();
                } else {
                    // „É´„Éº„É´„Éô„Éº„Çπ„Å´„Çà„ÇãÂàÜÊûê
                    result = performRuleBasedAnalysis();
                    updateStatus('warning', '‚ö†Ô∏è API„Ç≠„Éº„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑ„Åü„ÇÅ„ÄÅ„É´„Éº„É´„Éô„Éº„ÇπÂàÜÊûê„ÇíÂÆüË°å„Åó„Åæ„Åó„Åü');
                }

                // ÁµêÊûú„ÅÆ‰øùÂ≠ò„Å®Ë°®Á§∫
                localStorage.setItem('analysis_data', JSON.stringify(result));
                analysisData = result;
                displayAnalysisResults(result);
                
                updateStatus('success', '‚úÖ AIÂàÜÊûê„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü');
                
            } catch (error) {
                console.error('ÂàÜÊûê„Ç®„É©„Éº:', error);
                updateStatus('error', '‚ùå ÂàÜÊûê‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü: ' + error.message);
            } finally {
                isAnalyzing = false;
                startAnalysisBtn.disabled = false;
                startAnalysisBtn.innerHTML = 'ü§ñ GPT-3.5ÂàÜÊûêÈñãÂßã';
            }
        }

        // GPT-3.5„Å´„Çà„ÇãÂàÜÊûê
        async function performGPTAnalysis() {
            const prompt = `‰ª•‰∏ã„ÅÆÂÖ•Âäõ„Éá„Éº„Çø„ÇíÂàÜÊûê„Åó„Å¶„ÄÅ„É¶„Éº„Ç∂„Éº„ÅÆ„Çπ„Ç≠„É´„Å®ÊÄùËÄÉËª∏„ÇíÊäΩÂá∫„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ

ÂÖ•Âäõ„Éá„Éº„Çø:
${memoriesData.map(memory => memory.content).join('\n\n')}

‰ª•‰∏ã„ÅÆJSONÂΩ¢Âºè„ÅßÁµêÊûú„ÇíËøî„Åó„Å¶„Åè„Å†„Åï„ÅÑ:
{
  "skills": [
    {
      "name": "„Çπ„Ç≠„É´Âêç",
      "level": "beginner|intermediate|advanced|expert",
      "category": "„Ç´„ÉÜ„Ç¥„É™",
      "description": "Ë™¨Êòé",
      "frequency": Êï∞ÂÄ§(1-100)
    }
  ],
  "thinking_patterns": [
    {
      "name": "ÊÄùËÄÉËª∏Âêç",
      "frequency": Êï∞ÂÄ§(1-100),
      "percentage": Êï∞ÂÄ§(0-100),
      "examples": "Ë°åÂãï‰æã"
    }
  ]
}`;

            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${OPENAI_API_KEY}`
                },
                body: JSON.stringify({
                    model: 'gpt-3.5-turbo',
                    messages: [{
                        role: 'user',
                        content: prompt
                    }],
                    max_tokens: 1500,
                    temperature: 0.7
                })
            });

            if (!response.ok) {
                throw new Error(`OpenAI API error: ${response.status}`);
            }

            const data = await response.json();
            const analysisResult = JSON.parse(data.choices[0].message.content);
            
            return analysisResult;
        }

        // „É´„Éº„É´„Éô„Éº„ÇπÂàÜÊûê
        function performRuleBasedAnalysis() {
            const skills = [];
            const thinkingPatterns = [];
            
            // „ÉÜ„Ç≠„Çπ„ÉàËß£Êûê„Å´„Çà„Çã„Çπ„Ç≠„É´Ê§úÂá∫
            const skillKeywords = {
                '„Éó„É≠„Ç∞„É©„Éü„É≥„Ç∞': ['react', 'javascript', '„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà', 'hooks', '„Ç≥„Éº„Éâ'],
                'Ëã±Ë™ûÂ≠¶Áøí': ['Ëã±Ë™û', 'english', '„Éó„É¨„Çº„É≥', '‰ºöË©±', '„Éì„Ç∏„Éç„Çπ'],
                '„Éá„Éº„Çø„Éô„Éº„Çπ': ['„Éá„Éº„Çø„Éô„Éº„Çπ', 'sql', '„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ', 'ÊúÄÈÅ©Âåñ', 'db'],
                '„Éû„Éç„Ç∏„É°„É≥„Éà': ['„ÉÅ„Éº„É†', '„Éü„Éº„ÉÜ„Ç£„É≥„Ç∞', 'ÈÄ≤Êçó', '„Çø„Çπ„ÇØ', 'ÁÆ°ÁêÜ'],
                '„Éû„Éº„Ç±„ÉÜ„Ç£„É≥„Ç∞': ['„Éû„Éº„Ç±„ÉÜ„Ç£„É≥„Ç∞', 'È°ßÂÆ¢', '„Éã„Éº„Ç∫', 'Êà¶Áï•', 'ÂàÜÊûê']
            };

            const allText = memoriesData.map(m => m.content.toLowerCase()).join(' ');
            
            for (const [category, keywords] of Object.entries(skillKeywords)) {
                const matches = keywords.filter(keyword => allText.includes(keyword)).length;
                if (matches > 0) {
                    skills.push({
                        name: category,
                        level: matches >= 3 ? 'advanced' : matches >= 2 ? 'intermediate' : 'beginner',
                        category: 'ÊäÄË°ì',
                        description: `${category}„Å´Èñ¢ÈÄ£„Åô„ÇãÊ¥ªÂãï`,
                        frequency: Math.min(matches * 20, 100)
                    });
                }
            }

            // ÊÄùËÄÉ„Éë„Çø„Éº„É≥„ÅÆÊ§úÂá∫
            const thinkingKeywords = {
                'ÂÆüË∑µÂûãÊÄùËÄÉ': ['ÂÆüÈöõ„Å´', '‰Ωø„Å£„Å¶', 'Ë©¶„Åó„Å¶', 'ÂÆüË°å', 'ÂÆüË∑µ'],
                'Ë´ñÁêÜÂûãÊÄùËÄÉ': ['ÂàÜÊûê', 'ÁêÜËß£', 'Êï¥ÁêÜ', 'Ëß£Ê±∫', 'ÊúÄÈÅ©Âåñ'],
                'Â≠¶ÁøíÂûãÊÄùËÄÉ': ['Â≠¶Áøí', 'Ë¶ö„Åà„Å¶', 'ÁêÜËß£„Åß„Åç„Çã', 'ÂãâÂº∑', 'Á∑¥Áøí'],
                'ÂçîË™øÂûãÊÄùËÄÉ': ['„ÉÅ„Éº„É†', '„Éü„Éº„ÉÜ„Ç£„É≥„Ç∞', 'ÂàÜÊãÖ', '‰ºöË≠∞', 'ÂçîÂäõ'],
                'ÂâµÈÄ†ÂûãÊÄùËÄÉ': ['Êñ∞„Åó„ÅÑ', 'Êà¶Áï•', 'Ë®≠Ë®à', 'ÂâµÈÄ†', '„Ç¢„Ç§„Éá„Ç¢']
            };

            for (const [pattern, keywords] of Object.entries(thinkingKeywords)) {
                const matches = keywords.filter(keyword => allText.includes(keyword)).length;
                if (matches > 0) {
                    const frequency = Math.min(matches * 25, 100);
                    thinkingPatterns.push({
                        name: pattern,
                        frequency: frequency,
                        percentage: Math.round(frequency * 0.8),
                        examples: `${pattern}„Å´Èñ¢ÈÄ£„Åô„ÇãÊ¥ªÂãï„Éë„Çø„Éº„É≥`
                    });
                }
            }

            return {
                skills: skills,
                thinking_patterns: thinkingPatterns
            };
        }

        // ÂàÜÊûêÁµêÊûú„ÅÆË°®Á§∫
        function displayAnalysisResults(data) {
            updateSkillsTable(data.skills || []);
            updateThinkingTable(data.thinking_patterns || []);
        }

        // „Çπ„Ç≠„É´„ÉÜ„Éº„Éñ„É´„ÅÆÊõ¥Êñ∞
        function updateSkillsTable(skills) {
            if (skills.length === 0) {
                skillsTableBody.innerHTML = `
                    <tr>
                        <td colspan="5" class="empty-state">
                            <h3>üìä „Çπ„Ç≠„É´„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</h3>
                            <p>ÂàÜÊûê„ÇíÂÆüË°å„Åó„Å¶„Çπ„Ç≠„É´ÊÉÖÂ†±„ÇíË°®Á§∫„Åó„Åæ„Åô</p>
                        </td>
                    </tr>
                `;
                return;
            }

            skillsTableBody.innerHTML = skills.map(skill => `
                <tr class="fade-in">
                    <td><strong>${escapeHtml(skill.name)}</strong></td>
                    <td><span class="skill-level level-${skill.level}">${getLevelText(skill.level)}</span></td>
                    <td>${escapeHtml(skill.category)}</td>
                    <td>${escapeHtml(skill.description)}</td>
                    <td>${skill.frequency}%</td>
                </tr>
            `).join('');
        }

        // ÊÄùËÄÉËª∏„ÉÜ„Éº„Éñ„É´„ÅÆÊõ¥Êñ∞
        function updateThinkingTable(patterns) {
            if (patterns.length === 0) {
                thinkingTableBody.innerHTML = `
                    <tr>
                        <td colspan="4" class="empty-state">
                            <h3>üß† ÊÄùËÄÉËª∏„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</h3>
                            <p>ÂàÜÊûê„ÇíÂÆüË°å„Åó„Å¶ÊÄùËÄÉËª∏ÊÉÖÂ†±„ÇíË°®Á§∫„Åó„Åæ„Åô</p>
                        </td>
                    </tr>
                `;
                return;
            }

            thinkingTableBody.innerHTML = patterns.map(pattern => `
                <tr class="fade-in">
                    <td><strong>${escapeHtml(pattern.name)}</strong></td>
                    <td>
                        <div class="thinking-frequency">
                            <div class="frequency-bar">
                                <div class="frequency-fill" style="width: ${pattern.frequency}%"></div>
                            </div>
                            <span>${pattern.frequency}%</span>
                        </div>
                    </td>
                    <td>${pattern.percentage}%</td>
                    <td>${escapeHtml(pattern.examples)}</td>
                </tr>
            `).join('');
        }

        // „Çπ„ÉÜ„Éº„Çø„ÇπÊõ¥Êñ∞
        function updateStatus(type, message) {
            statusIndicator.className = `status-indicator status-${type}`;
            statusIndicator.textContent = message;
        }

        // „É¶„Éº„ÉÜ„Ç£„É™„ÉÜ„Ç£Èñ¢Êï∞
        function getLevelText(level) {
            const levels = {
                beginner: 'ÂàùÂøÉËÄÖ',
                intermediate: '‰∏≠Á¥öËÄÖ',
                advanced: '‰∏äÁ¥öËÄÖ',
                expert: '„Ç®„Ç≠„Çπ„Éë„Éº„Éà'
            };
            return levels[level] || level;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function logoutUser() {
            console.log('üîí Logging out...');
            
            // UserManager„ÅÆ„É≠„Ç∞„Ç¢„Ç¶„Éà
            if (window.userManager) {
                window.userManager.logout();
            }
            
            // „Çª„ÉÉ„Ç∑„Éß„É≥ÊÉÖÂ†±„Çí„ÇØ„É™„Ç¢
            sessionStorage.removeItem('authenticated');
            sessionStorage.removeItem('username');
            localStorage.removeItem('authenticated');
            localStorage.removeItem('username');
            localStorage.removeItem('currentUser');
            
            // „É≠„Ç∞„Ç§„É≥„Éö„Éº„Ç∏„Å´„É™„ÉÄ„Ç§„É¨„ÇØ„Éà
            window.location.href = 'index.html';
        }
    </script>
</body>
</html>