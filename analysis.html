<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìä AIÂàÜÊûê - „Çπ„Ç≠„É´„ÉªÊÄùËÄÉÊßãÈÄ†ÂèØË¶ñÂåñ</title>
    
    <!-- „ÉÜ„Éº„ÉûÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É† -->
    <script src="theme-manager.js"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #20b2aa;
            --primary-dark: #16a085;
            --secondary: #48d1cc;
            --accent: #06d6a0;
            --accent-dark: #05b08a;
            --warning: #f59e0b;
            --danger: #ef4444;
            --success: #10b981;
            
            /* „ÉÄ„Éº„ÇØ„É¢„Éº„Éâ */
            --bg-primary: #0f0f23;
            --bg-secondary: #1a1a2e;
            --bg-tertiary: #16213e;
            --bg-card: rgba(255, 255, 255, 0.05);
            --bg-glass: rgba(255, 255, 255, 0.1);
            
            --text-primary: #ffffff;
            --text-secondary: #cbd5e1;
            --text-muted: #64748b;
            
            --border: rgba(255, 255, 255, 0.1);
            --border-focus: rgba(32, 178, 170, 0.5);
        }

        /* „É©„Ç§„Éà„É¢„Éº„Éâ */
        :root.light-mode {
            --bg-primary: #f8fafc;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f1f5f9;
            --bg-card: rgba(0, 0, 0, 0.05);
            --bg-glass: rgba(0, 0, 0, 0.1);
            
            --text-primary: #1e293b;
            --text-secondary: #475569;
            --text-muted: #64748b;
            
            --border: rgba(0, 0, 0, 0.1);
            --border-focus: rgba(32, 178, 170, 0.5);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            word-wrap: break-word;
            overflow-wrap: break-word;
            hyphens: auto;
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }
        body {
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 50%, var(--bg-tertiary) 100%);
            background-attachment: fixed;
            color: var(--text-primary);
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            min-height: 100vh;
            overflow-x: auto;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 20%, rgba(32, 178, 170, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(72, 209, 204, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 60%, rgba(6, 214, 160, 0.05) 0%, transparent 50%);
            z-index: -1;
            animation: backgroundShift 20s ease-in-out infinite;
        }

        @keyframes backgroundShift {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
            padding: 1rem 0;
        }

        :root.light-mode .navbar {
            background: rgba(255, 255, 255, 0.95);
        }

        :root.light-mode .nav-link:hover {
            background: rgba(32, 178, 170, 0.1);
        }

        :root.light-mode .nav-link.active {
            background: rgba(32, 178, 170, 0.15);
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .nav-brand {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            text-decoration: none;
        }

        .nav-brand i {
            font-size: 1.8rem;
        }

        .nav-menu {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1rem;
            border-radius: 10px;
            color: var(--text-secondary);
            text-decoration: none;
            transition: all 0.3s ease;
            font-weight: 500;
            word-break: break-word;
            overflow-wrap: break-word;
            -webkit-hyphens: auto;
            -moz-hyphens: auto;
            hyphens: auto;
        }

        .nav-link:hover {
            color: var(--primary);
            background: rgba(32, 178, 170, 0.1);
            transform: translateY(-2px);
        }

        .nav-link.active {
            color: var(--primary);
            background: rgba(32, 178, 170, 0.2);
            box-shadow: 0 0 20px rgba(32, 178, 170, 0.3);
        }

        .nav-link i {
            font-size: 1.1rem;
        }

        .hamburger-menu {
            display: none;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .username-display {
            color: var(--primary);
            font-weight: 600;
        }

        .logout-btn {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
            border: 1px solid var(--danger);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            word-break: break-word;
            overflow-wrap: break-word;
            -webkit-hyphens: auto;
            -moz-hyphens: auto;
            hyphens: auto;
        }

        .logout-btn:hover {
            background: var(--danger);
            color: white;
        }

        /* „É¢„Éê„Ç§„É´Âêë„Åë„É¨„Çπ„Éù„É≥„Ç∑„Éñ„Éá„Ç∂„Ç§„É≥ */
        @media (max-width: 768px) {
            .nav-container {
                padding: 0 1rem;
            }
            
            .nav-menu {
                gap: 0.5rem;
            }
            
            .nav-link {
                padding: 0.5rem 0.75rem;
                font-size: 0.9rem;
            }
            
            .nav-link span {
                display: none;
            }
            
            .user-info {
                display: none;
            }
            
            .container {
                padding: 1rem;
            }
            
            .main-title h1 {
                font-size: 2rem;
            }
        }

        @media (max-width: 480px) {
            .nav-link {
                padding: 0.5rem;
                min-width: 40px;
                justify-content: center;
            }
        }

        .container {
            max-width: 1200px;
            margin: 80px auto 0;
            padding: 2rem;
        }
        .main-title {
            text-align: center;
            margin-bottom: 2rem;
        }
        .main-title h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, #20b2aa, #48d1cc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .main-title p {
            color: #cbd5e1;
            font-size: 1.1rem;
        }
        .analysis-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        .analysis-section:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: #20b2aa;
            transform: translateY(-2px);
        }
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        .section-title {
            font-size: 1.5rem;
            color: #20b2aa;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .action-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-secondary);
            border: 1px solid var(--border);
            word-break: break-word;
            overflow-wrap: break-word;
            -webkit-hyphens: auto;
            -moz-hyphens: auto;
            hyphens: auto;
        }
        .btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
            transform: translateY(-2px);
        }
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        .status-indicator {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            word-break: break-word;
            overflow-wrap: break-word;
            -webkit-hyphens: auto;
            -moz-hyphens: auto;
            hyphens: auto;
        }
        .status-success {
            color: var(--text-secondary);
            border-left: 3px solid #10b981;
        }
        .status-warning {
            color: var(--text-secondary);
            border-left: 3px solid #f59e0b;
        }
        .status-error {
            color: var(--text-secondary);
            border-left: 3px solid #ef4444;
        }
        .status-info {
            color: var(--text-secondary);
            border-left: 3px solid #20b2aa;
        }
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 15px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .data-table th,
        .data-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .data-table th {
            background: rgba(255, 255, 255, 0.05);
            color: #20b2aa;
            font-weight: 600;
        }
        .data-table tr:hover {
            background: rgba(32, 178, 170, 0.1);
        }
        .skill-level {
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.8rem;
            font-weight: 600;
        }
        .level-beginner { background: rgba(245, 158, 11, 0.15); color: #f59e0b; }
        .level-intermediate { background: rgba(32, 178, 170, 0.15); color: #20b2aa; }
        .level-advanced { background: rgba(16, 185, 129, 0.15); color: #10b981; }
        .level-expert { background: rgba(139, 92, 246, 0.15); color: #8b5cf6; }
        .thinking-frequency {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .frequency-bar {
            width: 100px;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }
        .frequency-fill {
            height: 100%;
            background: linear-gradient(90deg, #20b2aa, #48d1cc);
            transition: width 0.3s ease;
        }
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #cbd5e1;
        }
        .empty-state h3 {
            margin-bottom: 1rem;
            color: #ffffff;
        }
        .loading {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        .spinner {
            width: 1rem;
            height: 1rem;
            border: 2px solid transparent;
            border-top: 2px solid currentColor;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* „Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„Çπ„Çø„Ç§„É´ */
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 2000;
            display: none;
            justify-content: center;
            align-items: center;
        }

        .popup-overlay.show {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .popup-content {
            background: var(--bg-secondary);
            border-radius: 15px;
            padding: 2rem;
            max-width: 600px;
            max-height: 80vh;
            width: 90%;
            border: 1px solid var(--border);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            overflow-y: auto;
            position: relative;
            word-break: break-word;
            overflow-wrap: break-word;
            -webkit-hyphens: auto;
            -moz-hyphens: auto;
            hyphens: auto;
        }

        .popup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .popup-title {
            font-size: 1.5rem;
            color: var(--primary);
            margin: 0;
        }

        .popup-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .popup-close:hover {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
        }

        .popup-body {
            color: var(--text-secondary);
            line-height: 1.6;
            word-break: break-word;
            overflow-wrap: break-word;
            -webkit-hyphens: auto;
            -moz-hyphens: auto;
            hyphens: auto;
        }

        .popup-body h4 {
            color: var(--primary);
            margin: 1rem 0 0.5rem 0;
        }

        .popup-body ul {
            margin: 0.5rem 0;
            padding-left: 1.5rem;
        }

        .popup-body li {
            margin: 0.25rem 0;
        }

        .explain-btn {
            background: rgba(32, 178, 170, 0.2);
            color: var(--primary);
            border: 1px solid var(--primary);
            padding: 0.25rem 0.75rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .explain-btn:hover {
            background: var(--primary);
            color: white;
        }

        .explain-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        @media (max-width: 768px) {
            .nav-container {
                padding: 0 1rem;
            }
            
            .nav-menu {
                gap: 0.5rem;
            }
            
            .nav-link span {
                display: none;
            }
            
            .user-info {
                display: none;
            }
            
            .hamburger-menu {
                display: block;
            }
        }

        @media (max-width: 480px) {
            .nav-link {
                padding: 0.5rem;
                min-width: 40px;
                justify-content: center;
            }
        }

        /* „Çπ„Éû„ÉõÂØæÂøú (375px‰ª•‰∏ã) */
        @media (max-width: 375px) {
            .nav-container {
                padding: 0 0.5rem;
            }
            
            .nav-menu {
                display: none;
                position: fixed;
                top: 70px;
                left: 0;
                width: 100%;
                background: var(--bg-secondary);
                border-top: 1px solid var(--border);
                z-index: 999;
                flex-direction: column;
                padding: 1rem 0;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            }
            
            .nav-menu.active {
                display: flex;
            }
            
            .nav-link {
                width: 100%;
                padding: 1rem 2rem;
                justify-content: flex-start;
                border-bottom: 1px solid var(--border);
            }
            
            .nav-link span {
                display: inline;
            }
            
            .hamburger-menu {
                display: flex;
                flex-direction: column;
                cursor: pointer;
                padding: 0.5rem;
                gap: 3px;
            }
            
            .hamburger-line {
                width: 25px;
                height: 3px;
                background: var(--primary);
                transition: all 0.3s ease;
                border-radius: 2px;
            }
            
            .hamburger-menu.active .hamburger-line:nth-child(1) {
                transform: rotate(45deg) translate(6px, 6px);
            }
            
            .hamburger-menu.active .hamburger-line:nth-child(2) {
                opacity: 0;
            }
            
            .hamburger-menu.active .hamburger-line:nth-child(3) {
                transform: rotate(-45deg) translate(6px, -6px);
            }
            
            .user-info {
                display: none;
            }
            
            .container {
                margin-top: 70px;
                padding: 1rem 0.5rem;
            }
            
            .main-title h1 {
                font-size: 1.8rem;
            }
            
            .main-title p {
                font-size: 0.9rem;
            }
            
            .analysis-section {
                padding: 1rem;
                margin-bottom: 1rem;
            }
            
            .section-title {
                font-size: 1.2rem;
            }
            
            .action-buttons {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            /* „Çπ„Éû„ÉõÁî®„ÉÜ„Éº„Éñ„É´„Çπ„Çø„Ç§„É´ */
            .data-table {
                font-size: 0.7rem;
                border-collapse: separate;
                border-spacing: 0;
            }
            
            .data-table thead {
                display: none; /* „Éò„ÉÉ„ÉÄ„Éº„ÇíÈùûË°®Á§∫ */
            }
            
            .data-table tbody {
                display: block;
            }
            
            .data-table tr {
                display: flex;
                align-items: center;
                padding: 0.5rem;
                margin-bottom: 0.3rem;
                background: rgba(255, 255, 255, 0.03);
                border-radius: 8px;
                border: 1px solid rgba(255, 255, 255, 0.05);
                word-break: break-word;
                overflow-wrap: break-word;
            }
            
            .data-table tr:hover {
                background: rgba(32, 178, 170, 0.1);
            }
            
            /* „ÉÜ„Éº„Éñ„É´„Çª„É´„ÅÆÊñáÂ≠óÊäò„ÇäËøî„Åó */
            .data-table td,
            .data-table th {
                word-break: break-word;
                overflow-wrap: break-word;
                white-space: normal;
                text-overflow: ellipsis;
            }
            
            /* „Çπ„Ç≠„É´„ÉÜ„Éº„Éñ„É´Áî®„É¨„Ç§„Ç¢„Ç¶„Éà */
            .data-table#skillsTable td:nth-child(1) {
                flex: 2;
                font-weight: 600;
                font-size: 0.75rem;
                word-break: break-word;
                overflow-wrap: break-word;
                white-space: normal;
            }
            
            .data-table#skillsTable td:nth-child(2) {
                flex: 1;
                text-align: center;
                word-break: break-word;
                overflow-wrap: break-word;
            }
            
            .data-table#skillsTable td:nth-child(3),
            .data-table#skillsTable td:nth-child(4),
            .data-table#skillsTable td:nth-child(5) {
                display: none; /* „Ç´„ÉÜ„Ç¥„É™„ÄÅË™¨Êòé„ÄÅÈ†ªÂ∫¶„ÇíÈùûË°®Á§∫ */
            }
            
            .data-table#skillsTable td:nth-child(6) {
                flex: 0 0 auto;
                margin-left: auto;
            }
            
            /* ÊÄùËÄÉËª∏„ÉÜ„Éº„Éñ„É´Áî®„É¨„Ç§„Ç¢„Ç¶„Éà */
            .data-table#thinkingTable td:nth-child(1) {
                flex: 2;
                font-weight: 600;
                font-size: 0.75rem;
                word-break: break-word;
                overflow-wrap: break-word;
                white-space: normal;
            }
            
            .data-table#thinkingTable td:nth-child(2) {
                flex: 1;
                text-align: center;
                word-break: break-word;
                overflow-wrap: break-word;
            }
            
            .data-table#thinkingTable td:nth-child(3),
            .data-table#thinkingTable td:nth-child(4) {
                display: none; /* Ââ≤Âêà„ÄÅË°åÂãï‰æã„ÇíÈùûË°®Á§∫ */
            }
            
            .data-table#thinkingTable td:nth-child(5) {
                flex: 0 0 auto;
                margin-left: auto;
            }
            
            .skill-level {
                font-size: 0.6rem;
                padding: 0.15rem 0.4rem;
                border-radius: 6px;
                white-space: nowrap;
                word-break: keep-all;
                overflow-wrap: normal;
            }
            
            .explain-btn {
                padding: 0.25rem 0.4rem;
                font-size: 0.6rem;
                border-radius: 4px;
                white-space: nowrap;
                word-break: keep-all;
                overflow-wrap: normal;
            }
            
            .thinking-frequency {
                display: flex;
                align-items: center;
                gap: 0.3rem;
                font-size: 0.65rem;
                word-break: break-word;
                overflow-wrap: break-word;
            }
            
            .frequency-bar {
                width: 30px;
                height: 6px;
            }
            
            .popup-content {
                width: 95%;
                padding: 1rem;
                max-height: 90vh;
                word-break: break-word;
                overflow-wrap: break-word;
                white-space: pre-wrap;
            }
            
            .popup-title {
                font-size: 1.2rem;
                word-break: break-word;
                overflow-wrap: break-word;
            }
            
            .popup-body {
                font-size: 0.9rem;
                word-break: break-word;
                overflow-wrap: break-word;
                white-space: pre-wrap;
            }
            
            .status-indicator {
                font-size: 0.8rem;
                padding: 0.4rem 0.6rem;
                word-break: break-word;
                overflow-wrap: break-word;
                white-space: normal;
                text-align: center;
            }
            
            /* „Éú„Çø„É≥„ÅÆÊñáÂ≠óÊäò„ÇäËøî„Åó */
            .btn {
                word-break: break-word;
                overflow-wrap: break-word;
                white-space: normal;
                text-align: center;
            }
            
            /* „Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥„ÅÆÊñáÂ≠óÊäò„ÇäËøî„Åó */
            .nav-link {
                word-break: break-word;
                overflow-wrap: break-word;
                white-space: normal;
            }
            
            /* „É¢„Éê„Ç§„É´Âêë„Åë„ÉÜ„Éº„Éñ„É´„Éò„ÉÉ„ÉÄ„ÉºËøΩÂä† */
            .mobile-table-header {
                display: block;
                font-size: 0.65rem;
                color: var(--text-muted);
                margin-bottom: 0.5rem;
                padding: 0 0.5rem;
            }
        }

        /* Èï∑„ÅÑÂçòË™û„ÇÑËã±Êï∞Â≠ó„ÅÆÂº∑Âà∂ÊîπË°å */
        .nav-link,
        .btn,
        .data-table td,
        .data-table th,
        .popup-content,
        .status-indicator {
            word-break: break-word;
            overflow-wrap: break-word;
            -webkit-hyphens: auto;
            -moz-hyphens: auto;
            hyphens: auto;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <i class="fas fa-robot"></i>
                <span>RAGme</span>
            </div>
            <div class="nav-menu" id="navMenu">
                <a href="index.html" class="nav-link">
                    <i class="fas fa-home"></i>
                    <span>„Éõ„Éº„É†</span>
                </a>
                <a href="memory.html" class="nav-link">
                    <i class="fas fa-brain"></i>
                    <span>„É°„É¢„É™„Éº</span>
                </a>
                <a href="analysis.html" class="nav-link active">
                    <i class="fas fa-chart-line"></i>
                    <span>AIÂàÜÊûê</span>
                </a>
                <a href="settings.html" class="nav-link">
                    <i class="fas fa-cog"></i>
                    <span>Ë®≠ÂÆö</span>
                </a>
                <div class="user-info">
                    <span class="username-display" id="usernameDisplay"></span>
                    <button class="logout-btn" onclick="logoutUser()">
                        <i class="fas fa-sign-out-alt"></i> „É≠„Ç∞„Ç¢„Ç¶„Éà
                    </button>
                </div>
            </div>
            <div class="hamburger-menu" id="hamburgerMenu" onclick="toggleMobileMenu()">
                <div class="hamburger-line"></div>
                <div class="hamburger-line"></div>
                <div class="hamburger-line"></div>
            </div>
        </div>
    </nav>

    <main class="container">
        <div class="main-title">
            <h1><i class="fas fa-chart-line"></i> AIÂàÜÊûê</h1>
            <p>ÂÖ•Âäõ„Éá„Éº„Çø„Åã„Çâ„ÅÇ„Å™„Åü„ÅÆ„Çπ„Ç≠„É´„Å®ÊÄùËÄÉ„ÇíÂèØË¶ñÂåñ</p>
        </div>

        <!-- ÂàÜÊûêÂÆüË°å„Çª„ÇØ„Ç∑„Éß„É≥ -->
        <div class="analysis-section">
            <div class="section-header">
                <h2 class="section-title">
                    üîç AIÂàÜÊûêÂÆüË°å
                </h2>
                <div class="action-buttons">
                    <button class="btn" id="exportBtn" disabled>
                        üìÅ „Éá„Éº„Çø„Ç®„ÇØ„Çπ„Éù„Éº„Éà
                    </button>
                    <button class="btn" id="startAnalysisBtn">
                        ü§ñ GPT-3.5ÂàÜÊûêÈñãÂßã
                    </button>
                </div>
            </div>
            
            <div id="statusIndicator" class="status-indicator status-info">
                üìä ÂàÜÊûê„ÇíÈñãÂßã„Åô„Çã„Å´„ÅØ„ÄÅ‰∏ä„ÅÆ„Éú„Çø„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶„Åè„Å†„Åï„ÅÑ
            </div>
        </div>

        <!-- „Çπ„Ç≠„É´ÂàÜÊûêÁµêÊûú -->
        <div class="analysis-section">
            <div class="section-header">
                <h2 class="section-title">
                    üí° „Çπ„Ç≠„É´ÂàÜÊûêÁµêÊûú
                </h2>
            </div>
            
            <div id="skillsTableContainer">
                <table class="data-table" id="skillsTable">
                    <thead>
                        <tr>
                            <th>„Çπ„Ç≠„É´Âêç</th>
                            <th>„É¨„Éô„É´</th>
                            <th>„Ç´„ÉÜ„Ç¥„É™</th>
                            <th>Ë™¨Êòé</th>
                            <th>È†ªÂ∫¶</th>
                            <th>Ë©≥Á¥∞</th>
                        </tr>
                    </thead>
                    <tbody id="skillsTableBody">
                        <tr>
                            <td colspan="6" class="empty-state">
                                <h3>üìä ÂàÜÊûê„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</h3>
                                <p>AIÂàÜÊûê„ÇíÂÆüË°å„Åó„Å¶„Çπ„Ç≠„É´ÊÉÖÂ†±„ÇíË°®Á§∫„Åó„Åæ„Åô</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ÊÄùËÄÉËª∏ÂàÜÊûêÁµêÊûú -->
        <div class="analysis-section">
            <div class="section-header">
                <h2 class="section-title">
                    üß† ÊÄùËÄÉËª∏ÂàÜÊûêÁµêÊûú
                </h2>
            </div>
            
            <div id="thinkingTableContainer">
                <table class="data-table" id="thinkingTable">
                    <thead>
                        <tr>
                            <th>ÊÄùËÄÉËª∏Âêç</th>
                            <th>È†ªÂ∫¶</th>
                            <th>Ââ≤Âêà</th>
                            <th>Ë°åÂãï‰æã</th>
                            <th>Ë©≥Á¥∞</th>
                        </tr>
                    </thead>
                    <tbody id="thinkingTableBody">
                        <tr>
                            <td colspan="5" class="empty-state">
                                <h3>üß† ÂàÜÊûê„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</h3>
                                <p>AIÂàÜÊûê„ÇíÂÆüË°å„Åó„Å¶ÊÄùËÄÉËª∏ÊÉÖÂ†±„ÇíË°®Á§∫„Åó„Åæ„Åô</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <div class="mobile-menu" id="mobileMenu">
    </div>

    <!-- Ë™¨Êòé„Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó -->
    <div class="popup-overlay" id="explanationPopup">
        <div class="popup-content">
            <div class="popup-header">
                <h3 class="popup-title" id="popupTitle">Ë©≥Á¥∞Ë™¨Êòé</h3>
                <button class="popup-close" onclick="closeExplanationPopup()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="popup-body" id="popupBody">
                <!-- Ë™¨ÊòéÂÜÖÂÆπ„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô -->
            </div>
        </div>
    </div>

    <script>
        // ÈÅÖÂª∂Ë™çË®º„ÉÅ„Çß„ÉÉ„ÇØÈñ¢Êï∞
        function checkAuthenticationDelayed() {
            const isAuthenticated = 
                sessionStorage.getItem('authenticated') === 'true' || 
                localStorage.getItem('authenticated') === 'true' ||
                (window.userManager && window.userManager.isLoggedIn());

            if (!isAuthenticated) {
                console.log('üîí Authentication failed, redirecting to login...');
                window.location.href = 'index.html';
                return false;
            }
            
            console.log('‚úÖ Authentication check passed');
            return true;
        }

        // Âç≥Â∫ß„ÅÆË™çË®º„ÉÅ„Çß„ÉÉ„ÇØÔºà„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÔºâ
        (function() {
            const isAuthenticated = 
                sessionStorage.getItem('authenticated') === 'true' || 
                localStorage.getItem('authenticated') === 'true';

            if (!isAuthenticated) {
                console.log('üîí No authentication found, redirecting to login...');
                window.location.href = 'index.html';
                return;
            }
            
            console.log('‚úÖ Basic authentication check passed');
        })();

        // OpenAI API„Ç≠„ÉºÔºàÂÆüÈöõ„ÅÆ„Ç≠„Éº„Å´ÁΩÆ„ÅçÊèõ„Åà„Å¶„Åè„Å†„Åï„ÅÑÔºâ
        const OPENAI_API_KEY = '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';
        
        // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞
        let currentUser = '';
        let memoriesData = [];
        let analysisData = null;
        let isAnalyzing = false;
        let explanationsData = {};

        // DOMË¶ÅÁ¥†
        const statusIndicator = document.getElementById('statusIndicator');
        const exportBtn = document.getElementById('exportBtn');
        const startAnalysisBtn = document.getElementById('startAnalysisBtn');
        const skillsTableBody = document.getElementById('skillsTableBody');
        const thinkingTableBody = document.getElementById('thinkingTableBody');

        // „Éö„Éº„Ç∏ÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            initializePage();
            loadExistingData();
        });

        // ÁîªÈù¢„Çµ„Ç§„Ç∫Â§âÊõ¥ÊôÇ„Å´„ÉÜ„Éº„Éñ„É´Ë°®Á§∫„ÇíÊõ¥Êñ∞
        window.addEventListener('resize', function() {
            if (analysisData) {
                updateSkillsTable(analysisData.skills || []);
                updateThinkingTable(analysisData.thinking_patterns || []);
            }
        });

        // „Éö„Éº„Ç∏ÂàùÊúüÂåñ
        function initializePage() {
            // Ë™çË®º„ÉÅ„Çß„ÉÉ„ÇØ„ÇíÂÖà„Å´ÂÆüË°å
            if (!checkAuthenticationDelayed()) {
                return;
            }

            // „É¶„Éº„Ç∂„ÉºË™çË®º„ÉÅ„Çß„ÉÉ„ÇØ
            currentUser = localStorage.getItem('currentUser') || sessionStorage.getItem('username');
            if (!currentUser && window.userManager) {
                const user = window.userManager.getCurrentUser();
                if (user) {
                    currentUser = user.username;
                }
            }
            
            if (!currentUser) {
                console.log('üîí No user found, redirecting...');
                window.location.href = 'index.html';
                return;
            }

            // „É¶„Éº„Ç∂„ÉºÂêç„ÇíË°®Á§∫
            const usernameDisplay = document.getElementById('usernameDisplay');
            if (usernameDisplay) {
                usernameDisplay.textContent = currentUser;
            }

            // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºË®≠ÂÆö
            exportBtn.addEventListener('click', exportAnalysisData);
            startAnalysisBtn.addEventListener('click', startAnalysis);

            updateStatus('info', 'üìä ÂàÜÊûêÊ∫ñÂÇôÂÆå‰∫Ü„ÄÇ„Éá„Éº„Çø„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
            console.log('‚úÖ Page initialization complete');
        }

        // Êó¢Â≠ò„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø
        function loadExistingData() {
            try {
                // „É°„É¢„É™„Éº„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø
                const savedMemories = localStorage.getItem('ragme_memories');
                if (savedMemories) {
                    memoriesData = JSON.parse(savedMemories);
                    updateStatus('success', `üìö „É°„É¢„É™„Éº„Éá„Éº„Çø ${memoriesData.length}‰ª∂„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü`);
                } else {
                    updateStatus('warning', '‚ö†Ô∏è „É°„É¢„É™„Éº„Éá„Éº„Çø„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„ÄÇ„É°„É¢„É™„Éº„Éö„Éº„Ç∏„Åß„Éá„Éº„Çø„ÇíËøΩÂä†„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                }

                // Êó¢Â≠ò„ÅÆÂàÜÊûêÁµêÊûú„ÅÆË™≠„ÅøËæº„Åø
                const savedAnalysis = localStorage.getItem('analysis_data');
                if (savedAnalysis) {
                    analysisData = JSON.parse(savedAnalysis);
                    displayAnalysisResults(analysisData);
                    enableExportButton();
                    updateStatus('success', '‚úÖ ‰øùÂ≠òÊ∏à„Åø„ÅÆÂàÜÊûêÁµêÊûú„ÇíË°®Á§∫„Åó„Åæ„Åó„Åü');
                }

                // Êó¢Â≠ò„ÅÆË™¨Êòé„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø
                const savedExplanations = localStorage.getItem('explanations_data');
                if (savedExplanations) {
                    explanationsData = JSON.parse(savedExplanations);
                }
            } catch (error) {
                console.error('„Éá„Éº„ÇøË™≠„ÅøËæº„Åø„Ç®„É©„Éº:', error);
                updateStatus('error', '‚ùå „Éá„Éº„ÇøË™≠„ÅøËæº„Åø‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü');
            }
        }

        // „Ç®„ÇØ„Çπ„Éù„Éº„ÉàÊ©üËÉΩ
        function exportAnalysisData() {
            if (!analysisData) {
                updateStatus('warning', '‚ö†Ô∏è „Ç®„ÇØ„Çπ„Éù„Éº„Éà„Åô„ÇãÂàÜÊûê„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì');
                return;
            }

            try {
                // JSON„Éï„Ç°„Ç§„É´„Å®„Åó„Å¶„Ç®„ÇØ„Çπ„Éù„Éº„Éà
                                 const exportData = {
                     timestamp: new Date().toISOString(),
                     user: currentUser,
                     skills: analysisData.skills || [],
                     thinking_patterns: analysisData.thinking_patterns || [],
                     explanations: explanationsData || {},
                     memories_count: memoriesData.length
                 };

                const dataStr = JSON.stringify(exportData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `ragme_analysis_${currentUser}_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);

                // CSV„Éï„Ç°„Ç§„É´„ÇÇ„Ç®„ÇØ„Çπ„Éù„Éº„Éà
                exportCSVData(analysisData);

                updateStatus('success', '‚úÖ ÂàÜÊûê„Éá„Éº„Çø„Çí„Ç®„ÇØ„Çπ„Éù„Éº„Éà„Åó„Åæ„Åó„Åü');
            } catch (error) {
                console.error('„Ç®„ÇØ„Çπ„Éù„Éº„Éà„Ç®„É©„Éº:', error);
                updateStatus('error', '‚ùå „Éá„Éº„Çø„Ç®„ÇØ„Çπ„Éù„Éº„Éà„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            }
        }

        // CSV„Ç®„ÇØ„Çπ„Éù„Éº„ÉàÊ©üËÉΩ
        function exportCSVData(data) {
            try {
                // „Çπ„Ç≠„É´„Éá„Éº„Çø„ÅÆCSV
                const skillsCsv = convertSkillsToCSV(data.skills || []);
                const skillsBlob = new Blob([skillsCsv], { type: 'text/csv;charset=utf-8;' });
                
                const skillsLink = document.createElement('a');
                skillsLink.href = URL.createObjectURL(skillsBlob);
                skillsLink.download = `ragme_skills_${currentUser}_${new Date().toISOString().split('T')[0]}.csv`;
                document.body.appendChild(skillsLink);
                skillsLink.click();
                document.body.removeChild(skillsLink);

                // ÊÄùËÄÉËª∏„Éá„Éº„Çø„ÅÆCSV
                const thinkingCsv = convertThinkingToCSV(data.thinking_patterns || []);
                const thinkingBlob = new Blob([thinkingCsv], { type: 'text/csv;charset=utf-8;' });
                
                const thinkingLink = document.createElement('a');
                thinkingLink.href = URL.createObjectURL(thinkingBlob);
                thinkingLink.download = `ragme_thinking_${currentUser}_${new Date().toISOString().split('T')[0]}.csv`;
                document.body.appendChild(thinkingLink);
                thinkingLink.click();
                document.body.removeChild(thinkingLink);
            } catch (error) {
                console.error('CSV „Ç®„ÇØ„Çπ„Éù„Éº„Éà„Ç®„É©„Éº:', error);
            }
        }

        // „Çπ„Ç≠„É´„Éá„Éº„Çø„ÇíCSV„Å´Â§âÊèõ
        function convertSkillsToCSV(skills) {
            const headers = ['„Çπ„Ç≠„É´Âêç', '„É¨„Éô„É´', '„Ç´„ÉÜ„Ç¥„É™', 'Ë™¨Êòé', 'È†ªÂ∫¶', 'Ë©≥Á¥∞Ë™¨Êòé'];
            const csvRows = [headers.join(',')];
            
            skills.forEach(skill => {
                const explanation = explanationsData[`skill_${skill.name}`] || '';
                const row = [
                    `"${skill.name}"`,
                    `"${getLevelText(skill.level)}"`,
                    `"${skill.category}"`,
                    `"${skill.description}"`,
                    skill.frequency,
                    `"${explanation.replace(/"/g, '""')}"`
                ];
                csvRows.push(row.join(','));
            });
            
            return csvRows.join('\n');
        }

        // ÊÄùËÄÉËª∏„Éá„Éº„Çø„ÇíCSV„Å´Â§âÊèõ
        function convertThinkingToCSV(patterns) {
            const headers = ['ÊÄùËÄÉËª∏Âêç', 'È†ªÂ∫¶', 'Ââ≤Âêà', 'Ë°åÂãï‰æã', 'Ë©≥Á¥∞Ë™¨Êòé'];
            const csvRows = [headers.join(',')];
            
            patterns.forEach(pattern => {
                const explanation = explanationsData[`thinking_${pattern.name}`] || '';
                const row = [
                    `"${pattern.name}"`,
                    pattern.frequency,
                    pattern.percentage,
                    `"${pattern.examples}"`,
                    `"${explanation.replace(/"/g, '""')}"`
                ];
                csvRows.push(row.join(','));
            });
            
            return csvRows.join('\n');
        }

        // „Ç®„ÇØ„Çπ„Éù„Éº„Éà„Éú„Çø„É≥„ÅÆÊúâÂäπÂåñ
        function enableExportButton() {
            exportBtn.disabled = false;
            exportBtn.classList.remove('disabled');
        }

        // AIÂàÜÊûêÈñãÂßã
        async function startAnalysis() {
            if (isAnalyzing) return;
            
            if (memoriesData.length === 0) {
                updateStatus('warning', '‚ö†Ô∏è ÂàÜÊûê„Åô„Çã„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ„É°„É¢„É™„Éº„Éö„Éº„Ç∏„Åß„Éá„Éº„Çø„ÇíËøΩÂä†„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                return;
            }

            isAnalyzing = true;
            startAnalysisBtn.disabled = true;
            startAnalysisBtn.innerHTML = '<div class="loading"><div class="spinner"></div>ÂàÜÊûê‰∏≠...</div>';
            
            updateStatus('info', 'ü§ñ AIÂàÜÊûê„ÇíÈñãÂßã„Åó„Å¶„ÅÑ„Åæ„Åô...');

            try {
                let result;
                
                if (OPENAI_API_KEY && OPENAI_API_KEY !== 'YOUR_API_KEY_HERE') {
                    // GPT-3.5„Å´„Çà„ÇãÂàÜÊûê
                    result = await performGPTAnalysis();
                } else {
                    // „É´„Éº„É´„Éô„Éº„Çπ„Å´„Çà„ÇãÂàÜÊûê
                    result = performRuleBasedAnalysis();
                    updateStatus('warning', '‚ö†Ô∏è API„Ç≠„Éº„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑ„Åü„ÇÅ„ÄÅ„É´„Éº„É´„Éô„Éº„ÇπÂàÜÊûê„ÇíÂÆüË°å„Åó„Åæ„Åó„Åü');
                }

                // Ë™¨Êòé„ÅÆÁîüÊàê
                await generateExplanations(result);

                // ÁµêÊûú„ÅÆ‰øùÂ≠ò„Å®Ë°®Á§∫
                localStorage.setItem('analysis_data', JSON.stringify(result));
                analysisData = result;
                displayAnalysisResults(result);
                enableExportButton();
                
                updateStatus('success', '‚úÖ AIÂàÜÊûê„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü');
                
            } catch (error) {
                console.error('ÂàÜÊûê„Ç®„É©„Éº:', error);
                updateStatus('error', '‚ùå ÂàÜÊûê‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü: ' + error.message);
            } finally {
                isAnalyzing = false;
                startAnalysisBtn.disabled = false;
                startAnalysisBtn.innerHTML = 'ü§ñ GPT-3.5ÂàÜÊûêÈñãÂßã';
            }
        }

        // GPT-3.5„Å´„Çà„ÇãÂàÜÊûê
        async function performGPTAnalysis() {
            const prompt = `‰ª•‰∏ã„ÅÆÂÖ•Âäõ„Éá„Éº„Çø„ÇíÂàÜÊûê„Åó„Å¶„ÄÅ„É¶„Éº„Ç∂„Éº„ÅÆ„Çπ„Ç≠„É´„Å®ÊÄùËÄÉËª∏„ÇíÂåÖÊã¨ÁöÑ„Å´ÊäΩÂá∫„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
È†ªÂá∫„Åó„Å¶„ÅÑ„Å™„ÅÑ„Çπ„Ç≠„É´„ÇÑÊÄùËÄÉËª∏„ÇÇÂê´„ÇÅ„ÄÅÊúÄÂ§ß10È†ÖÁõÆ„Åö„Å§ÂàÜÊûê„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
È†ªÂ∫¶„Åå‰Ωé„ÅÑ„ÇÇ„ÅÆ„Åß„ÇÇÈáçË¶Å„Å™„Çπ„Ç≠„É´„ÇÑÊÄùËÄÉ„Éë„Çø„Éº„É≥„ÅØÂê´„ÇÅ„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ

ÂÖ•Âäõ„Éá„Éº„Çø:
${memoriesData.map(memory => memory.content).join('\n\n')}

ÂàÜÊûêË¶≥ÁÇπÔºö
„Äê„Çπ„Ç≠„É´ÂàÜÊûê„Äë
- ÊäÄË°ì„Çπ„Ç≠„É´Ôºà„Éó„É≠„Ç∞„É©„Éü„É≥„Ç∞„ÄÅ„Éá„Éº„Çø„Éô„Éº„Çπ„ÄÅAI/ML„ÄÅ„Éá„Ç∂„Ç§„É≥Á≠âÔºâ
- „Éì„Ç∏„Éç„Çπ„Çπ„Ç≠„É´Ôºà„Éû„Éç„Ç∏„É°„É≥„Éà„ÄÅ‰ºÅÁîª„ÄÅÂñ∂Ê•≠„ÄÅ„Éû„Éº„Ç±„ÉÜ„Ç£„É≥„Ç∞Á≠âÔºâ
- Ë™ûÂ≠¶„Çπ„Ç≠„É´ÔºàËã±Ë™û„ÄÅ„Åù„ÅÆ‰ªñË®ÄË™ûÔºâ
- „Ç≥„Éü„É•„Éã„Ç±„Éº„Ç∑„Éß„É≥„Çπ„Ç≠„É´Ôºà„Éó„É¨„Çº„É≥„ÄÅ‰ºöË≠∞„ÄÅ„ÉÅ„Éº„É†„ÉØ„Éº„ÇØÁ≠âÔºâ
- ÂàÜÊûê„ÉªÂïèÈ°åËß£Ê±∫„Çπ„Ç≠„É´
- ÂâµÈÄ†ÊÄß„Éª„Ç§„Éé„Éô„Éº„Ç∑„Éß„É≥
- Â≠¶ÁøíËÉΩÂäõ„ÉªÈÅ©ÂøúÂäõ
- Â∞ÇÈñÄÁü•Ë≠ò„ÉªÊ•≠ÁïåÁü•Ë≠ò

„ÄêÊÄùËÄÉËª∏ÂàÜÊûê„Äë
- Ë´ñÁêÜÂûãÊÄùËÄÉÔºàÂàÜÊûêÁöÑ„ÄÅ‰ΩìÁ≥ªÁöÑ„Ç¢„Éó„É≠„Éº„ÉÅÔºâ
- ÂâµÈÄ†ÂûãÊÄùËÄÉÔºàÁô∫ÊÉ≥Âäõ„ÄÅ„Ç¢„Ç§„Éá„Ç¢ÂâµÂá∫Ôºâ
- ÂÆüË∑µÂûãÊÄùËÄÉÔºàË°åÂãïÈáçË¶ñ„ÄÅÂÆüË£ÖÂøóÂêëÔºâ
- ÂçîË™øÂûãÊÄùËÄÉÔºà„ÉÅ„Éº„É†„ÉØ„Éº„ÇØ„ÄÅÂêàÊÑèÂΩ¢ÊàêÔºâ
- Â≠¶ÁøíÂûãÊÄùËÄÉÔºàÁü•Ë≠òÂê∏Âèé„ÄÅÊàêÈï∑ÂøóÂêëÔºâ
- Êà¶Áï•ÂûãÊÄùËÄÉÔºàÈï∑ÊúüË¶ñÁÇπ„ÄÅË®àÁîªÁ´ãÊ°àÔºâ
- Ë©≥Á¥∞ÂûãÊÄùËÄÉÔºàÁ≤æÂ∫¶ÈáçË¶ñ„ÄÅÂÆåÁíß‰∏ªÁæ©Ôºâ
- Èù©Êñ∞ÂûãÊÄùËÄÉÔºàÂ§âÈù©ÂøóÂêë„ÄÅÊñ∞„Åó„ÅÑÊåëÊà¶Ôºâ
- È°ßÂÆ¢ÂøóÂêëÊÄùËÄÉÔºà„É¶„Éº„Ç∂„ÉºÈáçË¶ñ„ÄÅ„Çµ„Éº„Éì„ÇπÊÄùËÄÉÔºâ
- ÂäπÁéáÂûãÊÄùËÄÉÔºàÊúÄÈÅ©Âåñ„ÄÅÁîüÁî£ÊÄßÂêë‰∏äÔºâ

‰ª•‰∏ã„ÅÆJSONÂΩ¢Âºè„ÅßÁµêÊûú„ÇíËøî„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºàÊúÄÂ§ßÂêÑ10È†ÖÁõÆÔºâ:
{
  "skills": [
    {
      "name": "„Çπ„Ç≠„É´Âêç",
      "level": "beginner|intermediate|advanced|expert",
      "category": "„Ç´„ÉÜ„Ç¥„É™",
      "description": "Ë™¨Êòé",
      "frequency": Êï∞ÂÄ§(1-100)
    }
  ],
  "thinking_patterns": [
    {
      "name": "ÊÄùËÄÉËª∏Âêç",
      "frequency": Êï∞ÂÄ§(1-100),
      "percentage": Êï∞ÂÄ§(0-100),
      "examples": "Ë°åÂãï‰æã"
    }
  ]
}`;

            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${OPENAI_API_KEY}`
                },
                body: JSON.stringify({
                    model: 'gpt-3.5-turbo',
                    messages: [{
                        role: 'user',
                        content: prompt
                    }],
                    max_tokens: 1500,
                    temperature: 0.7
                })
            });

            if (!response.ok) {
                throw new Error(`OpenAI API error: ${response.status}`);
            }

            const data = await response.json();
            const analysisResult = JSON.parse(data.choices[0].message.content);
            
            return analysisResult;
        }

        // „É´„Éº„É´„Éô„Éº„ÇπÂàÜÊûê
        function performRuleBasedAnalysis() {
            const skills = [];
            const thinkingPatterns = [];
            
            // ÂåÖÊã¨ÁöÑ„Å™„Çπ„Ç≠„É´Ê§úÂá∫ÔºàÊúÄÂ§ß10È†ÖÁõÆÔºâ
            const skillKeywords = {
                '„Éó„É≠„Ç∞„É©„Éü„É≥„Ç∞': ['react', 'javascript', '„Éó„É≠„Ç∞„É©„Éü„É≥„Ç∞', '„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà', 'hooks', '„Ç≥„Éº„Éâ', '„Ç¢„Éó„É™', '„Ç∑„Çπ„ÉÜ„É†'],
                '„Éá„Éº„Çø„Éô„Éº„Çπ': ['„Éá„Éº„Çø„Éô„Éº„Çπ', 'sql', '„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ', 'ÊúÄÈÅ©Âåñ', 'db', '„ÇØ„Ç®„É™', '„ÉÜ„Éº„Éñ„É´'],
                '„Éû„Éç„Ç∏„É°„É≥„Éà': ['„ÉÅ„Éº„É†', '„Éü„Éº„ÉÜ„Ç£„É≥„Ç∞', 'ÈÄ≤Êçó', '„Çø„Çπ„ÇØ', 'ÁÆ°ÁêÜ', '„Éó„É≠„Ç∏„Çß„ÇØ„Éà', 'ÊåáÂ∞é', '„É™„Éº„ÉÄ„Éº'],
                'Ëã±Ë™û„ÉªË™ûÂ≠¶': ['Ëã±Ë™û', 'english', '„Éó„É¨„Çº„É≥', '‰ºöË©±', '„Éì„Ç∏„Éç„Çπ', 'Ë°®Áèæ', 'Ë™ûÂ≠¶', 'ÁøªË®≥'],
                '„Éû„Éº„Ç±„ÉÜ„Ç£„É≥„Ç∞': ['„Éû„Éº„Ç±„ÉÜ„Ç£„É≥„Ç∞', 'È°ßÂÆ¢', '„Éã„Éº„Ç∫', 'Êà¶Áï•', '„É¶„Éº„Ç∂„Éº', 'Â∏ÇÂ†¥', 'ÂÆ£‰ºù'],
                '„Ç≥„Éü„É•„Éã„Ç±„Éº„Ç∑„Éß„É≥': ['„Ç≥„Éü„É•„Éã„Ç±„Éº„Ç∑„Éß„É≥', '‰ºöË©±', 'Ë™¨Êòé', '‰ºù„Åà„Çã', 'ÂÖ±Êúâ', 'Áõ∏Ë´á', 'ÂØæË©±'],
                'ÂàÜÊûê„ÉªÂïèÈ°åËß£Ê±∫': ['ÂàÜÊûê', 'Ëß£Ê±∫', 'Ë™≤È°å', 'ÂïèÈ°å', 'Ë™øÊüª', 'Ê§úË®º', 'ÊîπÂñÑ', 'ÂäπÁéá'],
                'Â≠¶Áøí„ÉªÊàêÈï∑': ['Â≠¶Áøí', 'ÂãâÂº∑', 'ÁøíÂæó', 'ÁêÜËß£', 'ÊàêÈï∑', 'Âêë‰∏ä', 'Á∑¥Áøí', 'Á†î‰øÆ'],
                '„Éá„Ç∂„Ç§„É≥„ÉªUI': ['„Éá„Ç∂„Ç§„É≥', 'ui', 'ux', 'ÁîªÈù¢', '„Ç§„É≥„Çø„Éº„Éï„Çß„Éº„Çπ', 'Ë¶ã„ÅüÁõÆ', '„É¨„Ç§„Ç¢„Ç¶„Éà'],
                '‰ºÅÁîª„ÉªÊà¶Áï•': ['‰ºÅÁîª', 'Ë®àÁîª', 'Êà¶Áï•', '„Ç¢„Ç§„Éá„Ç¢', 'ÊèêÊ°à', 'ÊßãÊÉ≥', 'Ë®≠Ë®à', 'Á´ãÊ°à']
            };

            const allText = memoriesData.map(m => m.content.toLowerCase()).join(' ');
            
            // ÂÖ®„Å¶„ÅÆ„Çπ„Ç≠„É´„Ç´„ÉÜ„Ç¥„É™„Çí„ÉÅ„Çß„ÉÉ„ÇØ
            for (const [category, keywords] of Object.entries(skillKeywords)) {
                const matches = keywords.filter(keyword => allText.includes(keyword)).length;
                const keywordCount = keywords.length;
                const matchRate = matches / keywordCount;
                
                let frequency, level;
                if (matches === 0) {
                    // „Éû„ÉÉ„ÉÅ„Åó„Å™„ÅÑÂ†¥Âêà„ÇÇÂü∫Êú¨È†ªÂ∫¶„ÇíË®≠ÂÆö
                    frequency = Math.floor(Math.random() * 15) + 5; // 5-20%„ÅÆÂü∫Êú¨È†ªÂ∫¶
                    level = 'beginner';
                } else {
                    frequency = Math.min(Math.max(matches * 15 + Math.floor(Math.random() * 10), 20), 100);
                    level = matches >= 4 ? 'advanced' : matches >= 2 ? 'intermediate' : 'beginner';
                }
                
                skills.push({
                    name: category,
                    level: level,
                    category: 'ÊäÄË°ì„Éª„Éì„Ç∏„Éç„Çπ',
                    description: `${category}„Å´Èñ¢ÈÄ£„Åô„ÇãÊ¥ªÂãï„ÇÑÁµåÈ®ì`,
                    frequency: frequency
                });
            }

            // ÂåÖÊã¨ÁöÑ„Å™ÊÄùËÄÉ„Éë„Çø„Éº„É≥„ÅÆÊ§úÂá∫ÔºàÊúÄÂ§ß10È†ÖÁõÆÔºâ
            const thinkingKeywords = {
                'Ë´ñÁêÜÂûãÊÄùËÄÉ': ['ÂàÜÊûê', 'ÁêÜËß£', 'Êï¥ÁêÜ', 'Ëß£Ê±∫', 'ÊúÄÈÅ©Âåñ', '‰ΩìÁ≥ªÁöÑ', 'Ë´ñÁêÜ', 'ÁêÜË´ñ'],
                'ÂÆüË∑µÂûãÊÄùËÄÉ': ['ÂÆüÈöõ„Å´', '‰Ωø„Å£„Å¶', 'Ë©¶„Åó„Å¶', 'ÂÆüË°å', 'ÂÆüË∑µ', 'Ë°åÂãï', 'ÂÆüË£Ö', 'ÂÖ∑‰ΩìÁöÑ'],
                'Â≠¶ÁøíÂûãÊÄùËÄÉ': ['Â≠¶Áøí', 'Ë¶ö„Åà„Å¶', 'ÁêÜËß£„Åß„Åç„Çã', 'ÂãâÂº∑', 'Á∑¥Áøí', 'ÁøíÂæó', 'Âêë‰∏ä', 'ÊàêÈï∑'],
                'ÂçîË™øÂûãÊÄùËÄÉ': ['„ÉÅ„Éº„É†', '„Éü„Éº„ÉÜ„Ç£„É≥„Ç∞', 'ÂàÜÊãÖ', '‰ºöË≠∞', 'ÂçîÂäõ', 'ÈÄ£Êê∫', 'ÂÖ±Êúâ', 'Áõ∏Ë´á'],
                'ÂâµÈÄ†ÂûãÊÄùËÄÉ': ['Êñ∞„Åó„ÅÑ', 'Êà¶Áï•', 'Ë®≠Ë®à', 'ÂâµÈÄ†', '„Ç¢„Ç§„Éá„Ç¢', 'Áô∫ÊÉ≥', 'Èù©Êñ∞', 'Â∑•Â§´'],
                'ÂäπÁéáÂûãÊÄùËÄÉ': ['ÂäπÁéá', 'ÊúÄÈÅ©Âåñ', 'ÊîπÂñÑ', 'ÁîüÁî£ÊÄß', 'ÊôÇÈñì', 'Á∞°Âçò', 'Êó©„Åè', 'ÂêàÁêÜ'],
                'Ë©≥Á¥∞ÂûãÊÄùËÄÉ': ['Ë©≥Á¥∞', 'Ê≠£Á¢∫', '‰∏ÅÂØß', 'ÊÖéÈáç', 'Á¢∫Ë™ç', 'Ê§úË®º', 'ÂìÅË≥™', 'Á≤æÂØÜ'],
                'Êà¶Áï•ÂûãÊÄùËÄÉ': ['Êà¶Áï•', 'Ë®àÁîª', 'Â∞ÜÊù•', 'Èï∑Êúü', 'ÁõÆÊ®ô', 'ÊñπÈáù', 'ÊßãÊÉ≥', '‰ºÅÁîª'],
                'È°ßÂÆ¢ÂøóÂêëÊÄùËÄÉ': ['È°ßÂÆ¢', '„É¶„Éº„Ç∂„Éº', '„Çµ„Éº„Éì„Çπ', '„Éã„Éº„Ç∫', 'Ë¶ÅÊ±Ç', 'Ê∫ÄË∂≥', '‰ΩìÈ®ì'],
                'Èù©Êñ∞ÂûãÊÄùËÄÉ': ['Èù©Êñ∞', 'Â§âÈù©', 'ÊåëÊà¶', 'Êñ∞Ë¶è', 'Â§âÂåñ', 'ÊîπÈù©', 'ÂÖàÈÄ≤', 'Êñ¨Êñ∞']
            };

            // ÂÖ®„Å¶„ÅÆÊÄùËÄÉËª∏„Çí„ÉÅ„Çß„ÉÉ„ÇØ
            for (const [pattern, keywords] of Object.entries(thinkingKeywords)) {
                const matches = keywords.filter(keyword => allText.includes(keyword)).length;
                const keywordCount = keywords.length;
                
                let frequency;
                if (matches === 0) {
                    // „Éû„ÉÉ„ÉÅ„Åó„Å™„ÅÑÂ†¥Âêà„ÇÇÂü∫Êú¨È†ªÂ∫¶„ÇíË®≠ÂÆö
                    frequency = Math.floor(Math.random() * 20) + 10; // 10-30%„ÅÆÂü∫Êú¨È†ªÂ∫¶
                } else {
                    frequency = Math.min(Math.max(matches * 12 + Math.floor(Math.random() * 15), 25), 100);
                }
                
                thinkingPatterns.push({
                    name: pattern,
                    frequency: frequency,
                    percentage: Math.round(frequency * 0.8 + Math.random() * 10),
                    examples: `${pattern}„Å´Èñ¢ÈÄ£„Åô„ÇãÊ¥ªÂãï„Éë„Çø„Éº„É≥„ÇÑË°®Áèæ`
                });
            }

            // È†ªÂ∫¶È†Ü„Å´„ÇΩ„Éº„Éà
            skills.sort((a, b) => b.frequency - a.frequency);
            thinkingPatterns.sort((a, b) => b.frequency - a.frequency);

            return {
                skills: skills,
                thinking_patterns: thinkingPatterns
            };
        }

        // ÂàÜÊûêÁµêÊûú„ÅÆË°®Á§∫
        function displayAnalysisResults(data) {
            updateSkillsTable(data.skills || []);
            updateThinkingTable(data.thinking_patterns || []);
        }

        // „Çπ„Ç≠„É´„ÉÜ„Éº„Éñ„É´„ÅÆÊõ¥Êñ∞
        function updateSkillsTable(skills) {
            if (skills.length === 0) {
                skillsTableBody.innerHTML = `
                    <tr>
                        <td colspan="6" class="empty-state">
                            <h3>üìä „Çπ„Ç≠„É´„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</h3>
                            <p>ÂàÜÊûê„ÇíÂÆüË°å„Åó„Å¶„Çπ„Ç≠„É´ÊÉÖÂ†±„ÇíË°®Á§∫„Åó„Åæ„Åô</p>
                        </td>
                    </tr>
                `;
                return;
            }

            // „É¢„Éê„Ç§„É´Âêë„Åë„Éò„ÉÉ„ÉÄ„Éº„ÇíËøΩÂä†
            const mobileHeader = window.innerWidth <= 375 ? 
                '<div class="mobile-table-header">„Çπ„Ç≠„É´Âêç | „É¨„Éô„É´ | Ë©≥Á¥∞</div>' : '';
            
            const tableContent = skills.map(skill => `
                <tr class="fade-in">
                    <td><strong>${escapeHtml(skill.name)}</strong></td>
                    <td><span class="skill-level level-${skill.level}">${getLevelText(skill.level)}</span></td>
                    <td>${escapeHtml(skill.category)}</td>
                    <td>${escapeHtml(skill.description)}</td>
                    <td>${skill.frequency}%</td>
                    <td>
                        <button class="explain-btn" onclick="showExplanation('skill', '${escapeHtml(skill.name)}')">
                            Ë©≥Á¥∞
                        </button>
                    </td>
                </tr>
            `).join('');

            skillsTableBody.innerHTML = tableContent;
            
            // „É¢„Éê„Ç§„É´„Éò„ÉÉ„ÉÄ„Éº„ÇíË°®Á§∫„Ç®„É™„Ç¢„ÅÆÂâç„Å´ÊåøÂÖ•
            if (window.innerWidth <= 375) {
                const container = document.getElementById('skillsTableContainer');
                const existingHeader = container.querySelector('.mobile-table-header');
                if (existingHeader) {
                    existingHeader.remove();
                }
                container.insertAdjacentHTML('afterbegin', mobileHeader);
            }
        }

        // ÊÄùËÄÉËª∏„ÉÜ„Éº„Éñ„É´„ÅÆÊõ¥Êñ∞
        function updateThinkingTable(patterns) {
            if (patterns.length === 0) {
                thinkingTableBody.innerHTML = `
                    <tr>
                        <td colspan="5" class="empty-state">
                            <h3>üß† ÊÄùËÄÉËª∏„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</h3>
                            <p>ÂàÜÊûê„ÇíÂÆüË°å„Åó„Å¶ÊÄùËÄÉËª∏ÊÉÖÂ†±„ÇíË°®Á§∫„Åó„Åæ„Åô</p>
                        </td>
                    </tr>
                `;
                return;
            }

            // „É¢„Éê„Ç§„É´Âêë„Åë„Éò„ÉÉ„ÉÄ„Éº„ÇíËøΩÂä†
            const mobileHeader = window.innerWidth <= 375 ? 
                '<div class="mobile-table-header">ÊÄùËÄÉËª∏Âêç | È†ªÂ∫¶ | Ë©≥Á¥∞</div>' : '';

            const tableContent = patterns.map(pattern => `
                <tr class="fade-in">
                    <td><strong>${escapeHtml(pattern.name)}</strong></td>
                    <td>
                        <div class="thinking-frequency">
                            <div class="frequency-bar">
                                <div class="frequency-fill" style="width: ${pattern.frequency}%"></div>
                            </div>
                            <span>${pattern.frequency}%</span>
                        </div>
                    </td>
                    <td>${pattern.percentage}%</td>
                    <td>${escapeHtml(pattern.examples)}</td>
                    <td>
                        <button class="explain-btn" onclick="showExplanation('thinking', '${escapeHtml(pattern.name)}')">
                            Ë©≥Á¥∞
                        </button>
                    </td>
                </tr>
            `).join('');

            thinkingTableBody.innerHTML = tableContent;
            
            // „É¢„Éê„Ç§„É´„Éò„ÉÉ„ÉÄ„Éº„ÇíË°®Á§∫„Ç®„É™„Ç¢„ÅÆÂâç„Å´ÊåøÂÖ•
            if (window.innerWidth <= 375) {
                const container = document.getElementById('thinkingTableContainer');
                const existingHeader = container.querySelector('.mobile-table-header');
                if (existingHeader) {
                    existingHeader.remove();
                }
                container.insertAdjacentHTML('afterbegin', mobileHeader);
            }
        }

        // „Çπ„ÉÜ„Éº„Çø„ÇπÊõ¥Êñ∞
        function updateStatus(type, message) {
            statusIndicator.className = `status-indicator status-${type}`;
            statusIndicator.textContent = message;
        }

        // „É¶„Éº„ÉÜ„Ç£„É™„ÉÜ„Ç£Èñ¢Êï∞
        function getLevelText(level) {
            const levels = {
                beginner: 'ÂàùÂøÉËÄÖ',
                intermediate: '‰∏≠Á¥öËÄÖ',
                advanced: '‰∏äÁ¥öËÄÖ',
                expert: '„Ç®„Ç≠„Çπ„Éë„Éº„Éà'
            };
            return levels[level] || level;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Ë™¨ÊòéÁîüÊàêÊ©üËÉΩ
        async function generateExplanations(data) {
            updateStatus('info', 'ü§ñ Ë©≥Á¥∞Ë™¨Êòé„ÇíÁîüÊàê„Åó„Å¶„ÅÑ„Åæ„Åô...');
            
            try {
                // „Çπ„Ç≠„É´„ÅÆË™¨ÊòéÁîüÊàê
                for (const skill of data.skills || []) {
                    const key = `skill_${skill.name}`;
                    if (!explanationsData[key]) {
                        if (OPENAI_API_KEY && OPENAI_API_KEY !== 'YOUR_API_KEY_HERE') {
                            explanationsData[key] = await generateGPTExplanation('skill', skill);
                        } else {
                            explanationsData[key] = generateRuleBasedExplanation('skill', skill);
                        }
                    }
                }

                // ÊÄùËÄÉËª∏„ÅÆË™¨ÊòéÁîüÊàê
                for (const pattern of data.thinking_patterns || []) {
                    const key = `thinking_${pattern.name}`;
                    if (!explanationsData[key]) {
                        if (OPENAI_API_KEY && OPENAI_API_KEY !== 'YOUR_API_KEY_HERE') {
                            explanationsData[key] = await generateGPTExplanation('thinking', pattern);
                        } else {
                            explanationsData[key] = generateRuleBasedExplanation('thinking', pattern);
                        }
                    }
                }

                // Ë™¨Êòé„Éá„Éº„Çø„ÅÆ‰øùÂ≠ò
                localStorage.setItem('explanations_data', JSON.stringify(explanationsData));
                
            } catch (error) {
                console.error('Ë™¨ÊòéÁîüÊàê„Ç®„É©„Éº:', error);
            }
        }

        // GPT„Å´„Çà„ÇãË™¨ÊòéÁîüÊàê
        async function generateGPTExplanation(type, item) {
            const prompt = type === 'skill' 
                ? `‰ª•‰∏ã„ÅÆ„Çπ„Ç≠„É´ÂàÜÊûêÁµêÊûú„Å´„Å§„ÅÑ„Å¶„ÄÅ„Å™„Åú„Åì„ÅÆ„Çà„ÅÜ„Å™ÁµêÊûú„Å´„Å™„Å£„Åü„ÅÆ„Åã„ÇíË©≥„Åó„ÅèË™¨Êòé„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºö

„Çπ„Ç≠„É´Âêç: ${item.name}
„É¨„Éô„É´: ${getLevelText(item.level)}
„Ç´„ÉÜ„Ç¥„É™: ${item.category}
È†ªÂ∫¶: ${item.frequency}%

ÂàÜÊûêÂØæË±°„ÅÆ„Éá„Éº„Çø:
${memoriesData.map(memory => memory.content).join('\n\n')}

‰ª•‰∏ã„ÅÆË¶≥ÁÇπ„Åã„ÇâË™¨Êòé„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºö
1. „Åì„ÅÆ„Çπ„Ç≠„É´„ÅåÊ§úÂá∫„Åï„Çå„ÅüÁêÜÁî±
2. „É¨„Éô„É´Âà§ÂÆö„ÅÆÊ†πÊã†
3. È†ªÂ∫¶„Çπ„Ç≥„Ç¢„ÅÆÁÆóÂá∫ÊñπÊ≥ï
4. ‰ªäÂæå„ÅÆÊàêÈï∑„Å´Âêë„Åë„Åü„Ç¢„Éâ„Éê„Ç§„Çπ`
                : `‰ª•‰∏ã„ÅÆÊÄùËÄÉËª∏ÂàÜÊûêÁµêÊûú„Å´„Å§„ÅÑ„Å¶„ÄÅ„Å™„Åú„Åì„ÅÆ„Çà„ÅÜ„Å™ÁµêÊûú„Å´„Å™„Å£„Åü„ÅÆ„Åã„ÇíË©≥„Åó„ÅèË™¨Êòé„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºö

ÊÄùËÄÉËª∏Âêç: ${item.name}
È†ªÂ∫¶: ${item.frequency}%
Ââ≤Âêà: ${item.percentage}%

ÂàÜÊûêÂØæË±°„ÅÆ„Éá„Éº„Çø:
${memoriesData.map(memory => memory.content).join('\n\n')}

‰ª•‰∏ã„ÅÆË¶≥ÁÇπ„Åã„ÇâË™¨Êòé„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºö
1. „Åì„ÅÆÊÄùËÄÉËª∏„ÅåÊ§úÂá∫„Åï„Çå„ÅüÁêÜÁî±
2. È†ªÂ∫¶„Å®Ââ≤Âêà„ÅÆÁÆóÂá∫ÊñπÊ≥ï
3. ÂÖ∑‰ΩìÁöÑ„Å™Ë°åÂãï„Éë„Çø„Éº„É≥„ÅÆ‰æã
4. „Åì„ÅÆÊÄùËÄÉËª∏„ÅÆÁâπÂæ¥„Å®Âº∑„Åø`;

            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${OPENAI_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-3.5-turbo',
                        messages: [{
                            role: 'user',
                            content: prompt
                        }],
                        max_tokens: 800,
                        temperature: 0.7
                    })
                });

                if (!response.ok) {
                    throw new Error(`OpenAI API error: ${response.status}`);
                }

                const data = await response.json();
                return data.choices[0].message.content;
            } catch (error) {
                console.error('GPTË™¨ÊòéÁîüÊàê„Ç®„É©„Éº:', error);
                return generateRuleBasedExplanation(type, item);
            }
        }

        // „É´„Éº„É´„Éô„Éº„Çπ„ÅÆË™¨ÊòéÁîüÊàê
        function generateRuleBasedExplanation(type, item) {
            if (type === 'skill') {
                return `<h4>üéØ „Çπ„Ç≠„É´Ê§úÂá∫„ÅÆÁêÜÁî±</h4>
<p>„Äå${item.name}„Äç„Å´Èñ¢ÈÄ£„Åô„Çã„Ç≠„Éº„ÉØ„Éº„Éâ„ÇÑÊ¥ªÂãï„Åå„É°„É¢„É™„Éº„Éá„Éº„ÇøÂÜÖ„ÅßÊ§úÂá∫„Åï„Çå„Åæ„Åó„Åü„ÄÇ</p>

<h4>üìä „É¨„Éô„É´Âà§ÂÆö„ÅÆÊ†πÊã†</h4>
<p><strong>${getLevelText(item.level)}</strong>„É¨„Éô„É´„Å®Âà§ÂÆö„Åï„Çå„ÅüÁêÜÁî±Ôºö</p>
<ul>
    <li>Èñ¢ÈÄ£„Ç≠„Éº„ÉØ„Éº„Éâ„ÅÆÂá∫ÁèæÈ†ªÂ∫¶: ${item.frequency}%</li>
    <li>Ê¥ªÂãïÂÜÖÂÆπ„ÅÆÂ∞ÇÈñÄÊÄß„ÇÑË§áÈõë„Åï</li>
    <li>ÂÆüË∑µÁöÑ„Å™ÁµåÈ®ì„ÇÑÊàêÊûú„ÅÆË®òËø∞</li>
</ul>

<h4>üöÄ ÊàêÈï∑„Å´Âêë„Åë„Åü„Ç¢„Éâ„Éê„Ç§„Çπ</h4>
<p>„Åì„ÅÆ„Çπ„Ç≠„É´„Çí„Åï„Çâ„Å´Âêë‰∏ä„Åï„Åõ„Çã„Åü„ÇÅ„Å´„ÄÅÁ∂ôÁ∂öÁöÑ„Å™Â≠¶Áøí„Å®ÂÆüË∑µ„ÇíÂøÉ„Åå„Åë„Åæ„Åó„Çá„ÅÜ„ÄÇ</p>`;
            } else {
                return `<h4>üß† ÊÄùËÄÉËª∏Ê§úÂá∫„ÅÆÁêÜÁî±</h4>
<p>„Äå${item.name}„Äç„Å´Èñ¢ÈÄ£„Åô„ÇãÊÄùËÄÉ„Éë„Çø„Éº„É≥„ÇÑË°åÂãï„Åå„É°„É¢„É™„Éº„Éá„Éº„ÇøÂÜÖ„ÅßÁ¢∫Ë™ç„Åï„Çå„Åæ„Åó„Åü„ÄÇ</p>

<h4>üìà È†ªÂ∫¶ÁÆóÂá∫„ÅÆÊñπÊ≥ï</h4>
<p>Èñ¢ÈÄ£„Åô„ÇãË°åÂãï„Éë„Çø„Éº„É≥„ÇÑË°®Áèæ„ÅÆÂá∫ÁèæÈ†ªÂ∫¶„ÇíÂàÜÊûê„Åó„ÄÅ${item.frequency}%„Å®„ÅÑ„ÅÜÁµêÊûú„Å´„Å™„Çä„Åæ„Åó„Åü„ÄÇ</p>

<h4>üí° „Åì„ÅÆÊÄùËÄÉËª∏„ÅÆÁâπÂæ¥</h4>
<p>„ÅÇ„Å™„Åü„ÅÆÊÄùËÄÉ„ÇÑË°åÂãï„ÅÆ‰∏≠„Åß„Äå${item.name}„ÄçÁöÑ„Å™„Ç¢„Éó„É≠„Éº„ÉÅ„ÅåË¶ã„Çâ„Çå„ÄÅ„Åì„Çå„ÅØÈáçË¶Å„Å™Âº∑„Åø„ÅÆ‰∏Ä„Å§„Åß„Åô„ÄÇ</p>

<h4>üåü Ê¥ªÁî®ÊñπÊ≥ï</h4>
<p>„Åì„ÅÆÊÄùËÄÉËª∏„ÇíÊÑèË≠òÁöÑ„Å´Ê¥ªÁî®„Åô„Çã„Åì„Å®„Åß„ÄÅ„Çà„ÇäÂäπÊûúÁöÑ„Å™ÂïèÈ°åËß£Ê±∫„ÇÑÊÑèÊÄùÊ±∫ÂÆö„Åå„Åß„Åç„Çã„Åß„Åó„Çá„ÅÜ„ÄÇ</p>`;
            }
        }

        // Ë™¨Êòé„Éù„ÉÉ„Éó„Ç¢„ÉÉ„ÉóË°®Á§∫
        function showExplanation(type, name) {
            const key = `${type}_${name}`;
            const explanation = explanationsData[key];
            
            // Âü∫Êú¨ÊÉÖÂ†±„ÇíÂèñÂæó
            let basicInfo = '';
            if (type === 'skill' && analysisData && analysisData.skills) {
                const skill = analysisData.skills.find(s => s.name === name);
                if (skill) {
                    basicInfo = `
                        <div style="background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                            <h4>üìä Âü∫Êú¨ÊÉÖÂ†±</h4>
                            <ul>
                                <li><strong>„Çπ„Ç≠„É´Âêç:</strong> ${escapeHtml(skill.name)}</li>
                                <li><strong>„É¨„Éô„É´:</strong> ${getLevelText(skill.level)}</li>
                                <li><strong>„Ç´„ÉÜ„Ç¥„É™:</strong> ${escapeHtml(skill.category)}</li>
                                <li><strong>È†ªÂ∫¶:</strong> ${skill.frequency}%</li>
                                <li><strong>Ë™¨Êòé:</strong> ${escapeHtml(skill.description)}</li>
                            </ul>
                        </div>
                    `;
                }
            } else if (type === 'thinking' && analysisData && analysisData.thinking_patterns) {
                const pattern = analysisData.thinking_patterns.find(p => p.name === name);
                if (pattern) {
                    basicInfo = `
                        <div style="background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                            <h4>üìä Âü∫Êú¨ÊÉÖÂ†±</h4>
                            <ul>
                                <li><strong>ÊÄùËÄÉËª∏Âêç:</strong> ${escapeHtml(pattern.name)}</li>
                                <li><strong>È†ªÂ∫¶:</strong> ${pattern.frequency}%</li>
                                <li><strong>Ââ≤Âêà:</strong> ${pattern.percentage}%</li>
                                <li><strong>Ë°åÂãï‰æã:</strong> ${escapeHtml(pattern.examples)}</li>
                            </ul>
                        </div>
                    `;
                }
            }
            
            const detailedExplanation = explanation || generateRuleBasedExplanation(type, { name });

            document.getElementById('popupTitle').innerHTML = `
                ${type === 'skill' ? 'üí°' : 'üß†'} ${escapeHtml(name)}
            `;
            document.getElementById('popupBody').innerHTML = basicInfo + detailedExplanation;
            document.getElementById('explanationPopup').classList.add('show');
        }

        // Ë™¨Êòé„Éù„ÉÉ„Éó„Ç¢„ÉÉ„ÉóÈñâ„Åò„Çã
        function closeExplanationPopup() {
            document.getElementById('explanationPopup').classList.remove('show');
        }

        // „Éù„ÉÉ„Éó„Ç¢„ÉÉ„ÉóÂ§ñ„ÇØ„É™„ÉÉ„ÇØ„ÅßÈñâ„Åò„Çã
        document.getElementById('explanationPopup').addEventListener('click', function(e) {
            if (e.target === this) {
                closeExplanationPopup();
            }
        });

        // „Éè„É≥„Éê„Éº„Ç¨„Éº„É°„Éã„É•„Éº„ÅÆÂà∂Âæ°
        function toggleMobileMenu() {
            const navMenu = document.getElementById('navMenu');
            const hamburgerMenu = document.getElementById('hamburgerMenu');
            
            navMenu.classList.toggle('active');
            hamburgerMenu.classList.toggle('active');
        }

        // „É°„Éã„É•„ÉºÂ§ñ„ÇØ„É™„ÉÉ„ÇØ„ÅßÈñâ„Åò„Çã
        document.addEventListener('click', function(e) {
            const navMenu = document.getElementById('navMenu');
            const hamburgerMenu = document.getElementById('hamburgerMenu');
            
            if (!hamburgerMenu.contains(e.target) && !navMenu.contains(e.target)) {
                navMenu.classList.remove('active');
                hamburgerMenu.classList.remove('active');
            }
        });

        // „Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥„É™„É≥„ÇØ„ÇØ„É™„ÉÉ„ÇØÊôÇ„Å´„É°„Éã„É•„Éº„ÇíÈñâ„Åò„Çã
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function() {
                const navMenu = document.getElementById('navMenu');
                const hamburgerMenu = document.getElementById('hamburgerMenu');
                navMenu.classList.remove('active');
                hamburgerMenu.classList.remove('active');
            });
        });

        function logoutUser() {
            console.log('üîí Logging out...');
            
            // UserManager„ÅÆ„É≠„Ç∞„Ç¢„Ç¶„Éà
            if (window.userManager) {
                window.userManager.logout();
            }
            
            // „Çª„ÉÉ„Ç∑„Éß„É≥ÊÉÖÂ†±„Çí„ÇØ„É™„Ç¢
            sessionStorage.removeItem('authenticated');
            sessionStorage.removeItem('username');
            localStorage.removeItem('authenticated');
            localStorage.removeItem('username');
            localStorage.removeItem('currentUser');
            
            // „É≠„Ç∞„Ç§„É≥„Éö„Éº„Ç∏„Å´„É™„ÉÄ„Ç§„É¨„ÇØ„Éà
            window.location.href = 'index.html';
        }
    </script>
</body>
</html>
