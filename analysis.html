<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“Š AIåˆ†æ - ã‚¹ã‚­ãƒ«ãƒ»æ€è€ƒæ§‹é€ å¯è¦–åŒ–</title>
    
    <!-- ãƒ†ãƒ¼ãƒç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  -->
    <script src="theme-manager.js"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #20b2aa;
            --primary-dark: #16a085;
            --secondary: #48d1cc;
            --accent: #06d6a0;
            --accent-dark: #05b08a;
            --warning: #f59e0b;
            --danger: #ef4444;
            --success: #10b981;
            
            /* ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ */
            --bg-primary: #0f0f23;
            --bg-secondary: #1a1a2e;
            --bg-tertiary: #16213e;
            --bg-card: rgba(255, 255, 255, 0.05);
            --bg-glass: rgba(255, 255, 255, 0.1);
            
            --text-primary: #ffffff;
            --text-secondary: #cbd5e1;
            --text-muted: #64748b;
            
            --border: rgba(255, 255, 255, 0.1);
            --border-focus: rgba(32, 178, 170, 0.5);
        }

        /* ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰ */
        :root.light-mode {
            --bg-primary: #f8fafc;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f1f5f9;
            --bg-card: rgba(0, 0, 0, 0.05);
            --bg-glass: rgba(0, 0, 0, 0.1);
            
            --text-primary: #1e293b;
            --text-secondary: #475569;
            --text-muted: #64748b;
            
            --border: rgba(0, 0, 0, 0.1);
            --border-focus: rgba(32, 178, 170, 0.5);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            word-wrap: break-word;
            overflow-wrap: break-word;
            hyphens: auto;
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }
        body {
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 50%, var(--bg-tertiary) 100%);
            background-attachment: fixed;
            color: var(--text-primary);
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            min-height: 100vh;
            overflow-x: auto;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 20%, rgba(32, 178, 170, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(72, 209, 204, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 60%, rgba(6, 214, 160, 0.05) 0%, transparent 50%);
            z-index: -1;
            animation: backgroundShift 20s ease-in-out infinite;
        }

        @keyframes backgroundShift {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
            padding: 1rem 0;
        }

        :root.light-mode .navbar {
            background: rgba(255, 255, 255, 0.95);
        }

        :root.light-mode .nav-link:hover {
            background: rgba(32, 178, 170, 0.1);
        }

        :root.light-mode .nav-link.active {
            background: rgba(32, 178, 170, 0.15);
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .nav-brand {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            text-decoration: none;
        }

        .nav-brand i {
            font-size: 1.8rem;
        }

        .nav-menu {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1rem;
            border-radius: 10px;
            color: var(--text-secondary);
            text-decoration: none;
            transition: all 0.3s ease;
            font-weight: 500;
            word-break: break-word;
            overflow-wrap: break-word;
            -webkit-hyphens: auto;
            -moz-hyphens: auto;
            hyphens: auto;
        }

        .nav-link:hover {
            color: var(--primary);
            background: rgba(32, 178, 170, 0.1);
            transform: translateY(-2px);
        }

        .nav-link.active {
            color: var(--primary);
            background: rgba(32, 178, 170, 0.2);
            box-shadow: 0 0 20px rgba(32, 178, 170, 0.3);
        }

        .nav-link i {
            font-size: 1.1rem;
        }

        .hamburger-menu {
            display: none;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .username-display {
            color: var(--primary);
            font-weight: 600;
        }

        .logout-btn {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
            border: 1px solid var(--danger);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            word-break: break-word;
            overflow-wrap: break-word;
            -webkit-hyphens: auto;
            -moz-hyphens: auto;
            hyphens: auto;
        }

        .logout-btn:hover {
            background: var(--danger);
            color: white;
        }

        /* ãƒ¢ãƒã‚¤ãƒ«å‘ã‘ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ */
        @media (max-width: 768px) {
            .nav-container {
                padding: 0 1rem;
            }
            
            .nav-menu {
                gap: 0.5rem;
            }
            
            .nav-link {
                padding: 0.5rem 0.75rem;
                font-size: 0.9rem;
            }
            
            .nav-link span {
                display: none;
            }
            
            .user-info {
                display: none;
            }
            
            .container {
                padding: 1rem;
            }
            
            .main-title h1 {
                font-size: 2rem;
            }
        }

        @media (max-width: 480px) {
            .nav-link {
                padding: 0.5rem;
                min-width: 40px;
                justify-content: center;
            }
        }

        .container {
            max-width: 1200px;
            margin: 80px auto 0;
            padding: 2rem;
        }
        .main-title {
            text-align: center;
            margin-bottom: 2rem;
        }
        .main-title h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, #20b2aa, #48d1cc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .main-title p {
            color: #cbd5e1;
            font-size: 1.1rem;
        }
        .analysis-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        .analysis-section:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: #20b2aa;
            transform: translateY(-2px);
        }
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        .section-title {
            font-size: 1.5rem;
            color: #20b2aa;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .action-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-secondary);
            border: 1px solid var(--border);
            word-break: break-word;
            overflow-wrap: break-word;
            -webkit-hyphens: auto;
            -moz-hyphens: auto;
            hyphens: auto;
        }
        .btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
            transform: translateY(-2px);
        }
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        .status-indicator {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            word-break: break-word;
            overflow-wrap: break-word;
            -webkit-hyphens: auto;
            -moz-hyphens: auto;
            hyphens: auto;
        }
        .status-success {
            color: var(--text-secondary);
            border-left: 3px solid #10b981;
        }
        .status-warning {
            color: var(--text-secondary);
            border-left: 3px solid #f59e0b;
        }
        .status-error {
            color: var(--text-secondary);
            border-left: 3px solid #ef4444;
        }
        .status-info {
            color: var(--text-secondary);
            border-left: 3px solid #20b2aa;
        }
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 15px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .data-table th,
        .data-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .data-table th {
            background: rgba(255, 255, 255, 0.05);
            color: #20b2aa;
            font-weight: 600;
        }
        .data-table tr:hover {
            background: rgba(32, 178, 170, 0.1);
        }
        .skill-level {
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.8rem;
            font-weight: 600;
        }
        .level-beginner { background: rgba(245, 158, 11, 0.15); color: #f59e0b; }
        .level-intermediate { background: rgba(32, 178, 170, 0.15); color: #20b2aa; }
        .level-advanced { background: rgba(16, 185, 129, 0.15); color: #10b981; }
        .level-expert { background: rgba(139, 92, 246, 0.15); color: #8b5cf6; }
        .thinking-frequency {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .frequency-bar {
            width: 100px;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }
        .frequency-fill {
            height: 100%;
            background: linear-gradient(90deg, #20b2aa, #48d1cc);
            transition: width 0.3s ease;
        }
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #cbd5e1;
        }
        .empty-state h3 {
            margin-bottom: 1rem;
            color: #ffffff;
        }
        .loading {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        .spinner {
            width: 1rem;
            height: 1rem;
            border: 2px solid transparent;
            border-top: 2px solid currentColor;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚¹ã‚¿ã‚¤ãƒ« */
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 2000;
            display: none;
            justify-content: center;
            align-items: center;
        }

        .popup-overlay.show {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .popup-content {
            background: var(--bg-secondary);
            border-radius: 15px;
            padding: 2rem;
            max-width: 600px;
            max-height: 80vh;
            width: 90%;
            border: 1px solid var(--border);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            overflow-y: auto;
            position: relative;
            word-break: break-word;
            overflow-wrap: break-word;
            -webkit-hyphens: auto;
            -moz-hyphens: auto;
            hyphens: auto;
        }

        .popup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .popup-title {
            font-size: 1.5rem;
            color: var(--primary);
            margin: 0;
        }

        .popup-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .popup-close:hover {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
        }

        .popup-body {
            color: var(--text-secondary);
            line-height: 1.6;
            word-break: break-word;
            overflow-wrap: break-word;
            -webkit-hyphens: auto;
            -moz-hyphens: auto;
            hyphens: auto;
        }

        .popup-body h4 {
            color: var(--primary);
            margin: 1rem 0 0.5rem 0;
        }

        .popup-body ul {
            margin: 0.5rem 0;
            padding-left: 1.5rem;
        }

        .popup-body li {
            margin: 0.25rem 0;
        }

        .explain-btn {
            background: rgba(32, 178, 170, 0.2);
            color: var(--primary);
            border: 1px solid var(--primary);
            padding: 0.25rem 0.75rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .explain-btn:hover {
            background: var(--primary);
            color: white;
        }

        .explain-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        @media (max-width: 768px) {
            .nav-container {
                padding: 0 1rem;
            }
            
            .nav-menu {
                gap: 0.5rem;
            }
            
            .nav-link span {
                display: none;
            }
            
            .user-info {
                display: none;
            }
            
            .hamburger-menu {
                display: block;
            }
        }

        @media (max-width: 480px) {
            .nav-link {
                padding: 0.5rem;
                min-width: 40px;
                justify-content: center;
            }
        }

        /* ã‚¹ãƒãƒ›å¯¾å¿œ (375pxä»¥ä¸‹) */
        @media (max-width: 375px) {
            .nav-container {
                padding: 0 0.5rem;
            }
            
            .nav-menu {
                display: none;
                position: fixed;
                top: 70px;
                left: 0;
                width: 100%;
                background: var(--bg-secondary);
                border-top: 1px solid var(--border);
                z-index: 999;
                flex-direction: column;
                padding: 1rem 0;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            }
            
            .nav-menu.active {
                display: flex;
            }
            
            .nav-link {
                width: 100%;
                padding: 1rem 2rem;
                justify-content: flex-start;
                border-bottom: 1px solid var(--border);
            }
            
            .nav-link span {
                display: inline;
            }
            
            .hamburger-menu {
                display: flex;
                flex-direction: column;
                cursor: pointer;
                padding: 0.5rem;
                gap: 3px;
            }
            
            .hamburger-line {
                width: 25px;
                height: 3px;
                background: var(--primary);
                transition: all 0.3s ease;
                border-radius: 2px;
            }
            
            .hamburger-menu.active .hamburger-line:nth-child(1) {
                transform: rotate(45deg) translate(6px, 6px);
            }
            
            .hamburger-menu.active .hamburger-line:nth-child(2) {
                opacity: 0;
            }
            
            .hamburger-menu.active .hamburger-line:nth-child(3) {
                transform: rotate(-45deg) translate(6px, -6px);
            }
            
            .user-info {
                display: none;
            }
            
            .container {
                margin-top: 70px;
                padding: 1rem 0.5rem;
            }
            
            .main-title h1 {
                font-size: 1.8rem;
            }
            
            .main-title p {
                font-size: 0.9rem;
            }
            
            .analysis-section {
                padding: 1rem;
                margin-bottom: 1rem;
            }
            
            .section-title {
                font-size: 1.2rem;
            }
            
            .action-buttons {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            /* ã‚¹ãƒãƒ›ç”¨ãƒ†ãƒ¼ãƒ–ãƒ«ã‚¹ã‚¿ã‚¤ãƒ« */
            .data-table {
                font-size: 0.7rem;
                border-collapse: separate;
                border-spacing: 0;
            }
            
            .data-table thead {
                display: none; /* ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’éè¡¨ç¤º */
            }
            
            .data-table tbody {
                display: block;
            }
            
            .data-table tr {
                display: flex;
                align-items: center;
                padding: 0.5rem;
                margin-bottom: 0.3rem;
                background: rgba(255, 255, 255, 0.03);
                border-radius: 8px;
                border: 1px solid rgba(255, 255, 255, 0.05);
                word-break: break-word;
                overflow-wrap: break-word;
            }
            
            .data-table tr:hover {
                background: rgba(32, 178, 170, 0.1);
            }
            
            /* ãƒ†ãƒ¼ãƒ–ãƒ«ã‚»ãƒ«ã®æ–‡å­—æŠ˜ã‚Šè¿”ã— */
            .data-table td,
            .data-table th {
                word-break: break-word;
                overflow-wrap: break-word;
                white-space: normal;
                text-overflow: ellipsis;
            }
            
            /* ã‚¹ã‚­ãƒ«ãƒ†ãƒ¼ãƒ–ãƒ«ç”¨ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
            .data-table#skillsTable td:nth-child(1) {
                flex: 2;
                font-weight: 600;
                font-size: 0.75rem;
                word-break: break-word;
                overflow-wrap: break-word;
                white-space: normal;
            }
            
            .data-table#skillsTable td:nth-child(2) {
                flex: 1;
                text-align: center;
                word-break: break-word;
                overflow-wrap: break-word;
            }
            
            .data-table#skillsTable td:nth-child(3),
            .data-table#skillsTable td:nth-child(4),
            .data-table#skillsTable td:nth-child(5) {
                display: none; /* ã‚«ãƒ†ã‚´ãƒªã€èª¬æ˜ã€é »åº¦ã‚’éè¡¨ç¤º */
            }
            
            .data-table#skillsTable td:nth-child(6) {
                flex: 0 0 auto;
                margin-left: auto;
            }
            
            /* æ€è€ƒè»¸ãƒ†ãƒ¼ãƒ–ãƒ«ç”¨ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
            .data-table#thinkingTable td:nth-child(1) {
                flex: 2;
                font-weight: 600;
                font-size: 0.75rem;
                word-break: break-word;
                overflow-wrap: break-word;
                white-space: normal;
            }
            
            .data-table#thinkingTable td:nth-child(2) {
                flex: 1;
                text-align: center;
                word-break: break-word;
                overflow-wrap: break-word;
            }
            
            .data-table#thinkingTable td:nth-child(3),
            .data-table#thinkingTable td:nth-child(4) {
                display: none; /* å‰²åˆã€è¡Œå‹•ä¾‹ã‚’éè¡¨ç¤º */
            }
            
            .data-table#thinkingTable td:nth-child(5) {
                flex: 0 0 auto;
                margin-left: auto;
            }
            
            .skill-level {
                font-size: 0.6rem;
                padding: 0.15rem 0.4rem;
                border-radius: 6px;
                white-space: nowrap;
                word-break: keep-all;
                overflow-wrap: normal;
            }
            
            .explain-btn {
                padding: 0.25rem 0.4rem;
                font-size: 0.6rem;
                border-radius: 4px;
                white-space: nowrap;
                word-break: keep-all;
                overflow-wrap: normal;
            }
            
            .thinking-frequency {
                display: flex;
                align-items: center;
                gap: 0.3rem;
                font-size: 0.65rem;
                word-break: break-word;
                overflow-wrap: break-word;
            }
            
            .frequency-bar {
                width: 30px;
                height: 6px;
            }
            
            .popup-content {
                width: 95%;
                padding: 1rem;
                max-height: 90vh;
                word-break: break-word;
                overflow-wrap: break-word;
                white-space: pre-wrap;
            }
            
            .popup-title {
                font-size: 1.2rem;
                word-break: break-word;
                overflow-wrap: break-word;
            }
            
            .popup-body {
                font-size: 0.9rem;
                word-break: break-word;
                overflow-wrap: break-word;
                white-space: pre-wrap;
            }
            
            .status-indicator {
                font-size: 0.8rem;
                padding: 0.4rem 0.6rem;
                word-break: break-word;
                overflow-wrap: break-word;
                white-space: normal;
                text-align: center;
            }
            
            /* ãƒœã‚¿ãƒ³ã®æ–‡å­—æŠ˜ã‚Šè¿”ã— */
            .btn {
                word-break: break-word;
                overflow-wrap: break-word;
                white-space: normal;
                text-align: center;
            }
            
            /* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã®æ–‡å­—æŠ˜ã‚Šè¿”ã— */
            .nav-link {
                word-break: break-word;
                overflow-wrap: break-word;
                white-space: normal;
            }
            
            /* ãƒ¢ãƒã‚¤ãƒ«å‘ã‘ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼è¿½åŠ  */
            .mobile-table-header {
                display: block;
                font-size: 0.65rem;
                color: var(--text-muted);
                margin-bottom: 0.5rem;
                padding: 0 0.5rem;
            }
        }

        /* é•·ã„å˜èªã‚„è‹±æ•°å­—ã®å¼·åˆ¶æ”¹è¡Œ */
        .nav-link,
        .btn,
        .data-table td,
        .data-table th,
        .popup-content,
        .status-indicator {
            word-break: break-word;
            overflow-wrap: break-word;
            -webkit-hyphens: auto;
            -moz-hyphens: auto;
            hyphens: auto;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <i class="fas fa-robot"></i>
                <span>RAGme</span>
            </div>
            <div class="nav-menu" id="navMenu">
                <a href="index.html" class="nav-link">
                    <i class="fas fa-home"></i>
                    <span>ãƒ›ãƒ¼ãƒ </span>
                </a>
                <a href="memory.html" class="nav-link">
                    <i class="fas fa-brain"></i>
                    <span>ãƒ¡ãƒ¢ãƒªãƒ¼</span>
                </a>
                <a href="analysis.html" class="nav-link active">
                    <i class="fas fa-chart-line"></i>
                    <span>AIåˆ†æ</span>
                </a>
                <a href="settings.html" class="nav-link">
                    <i class="fas fa-cog"></i>
                    <span>è¨­å®š</span>
                </a>
                <div class="user-info">
                    <span class="username-display" id="usernameDisplay"></span>
                    <button class="logout-btn" onclick="logoutUser()">
                        <i class="fas fa-sign-out-alt"></i> ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
                    </button>
                </div>
            </div>
            <div class="hamburger-menu" id="hamburgerMenu" onclick="toggleMobileMenu()">
                <div class="hamburger-line"></div>
                <div class="hamburger-line"></div>
                <div class="hamburger-line"></div>
            </div>
        </div>
    </nav>

    <main class="container">
        <div class="main-title">
            <h1><i class="fas fa-chart-line"></i> AIåˆ†æ</h1>
            <p>å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ã‚ãªãŸã®ã‚¹ã‚­ãƒ«ã¨æ€è€ƒã‚’å¯è¦–åŒ–</p>
        </div>

        <!-- åˆ†æå®Ÿè¡Œã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="analysis-section">
            <div class="section-header">
                <h2 class="section-title">
                    ğŸ” AIåˆ†æå®Ÿè¡Œ
                </h2>
                <div class="action-buttons">
                    <button class="btn" id="exportBtn" disabled>
                        ğŸ“ ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
                    </button>
                    <button class="btn" id="startAnalysisBtn">
                        ğŸ¤– GPT-3.5åˆ†æé–‹å§‹
                    </button>
                </div>
            </div>
            
            <div id="statusIndicator" class="status-indicator status-info">
                ğŸ“Š åˆ†æã‚’é–‹å§‹ã™ã‚‹ã«ã¯ã€ä¸Šã®ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„
            </div>
        </div>

        <!-- ã‚¹ã‚­ãƒ«åˆ†æçµæœ -->
        <div class="analysis-section">
            <div class="section-header">
                <h2 class="section-title">
                    ğŸ’¡ ã‚¹ã‚­ãƒ«åˆ†æçµæœ
                </h2>
            </div>
            
            <div id="skillsTableContainer">
                <table class="data-table" id="skillsTable">
                    <thead>
                        <tr>
                            <th>ã‚¹ã‚­ãƒ«å</th>
                            <th>ãƒ¬ãƒ™ãƒ«</th>
                            <th>ã‚«ãƒ†ã‚´ãƒª</th>
                            <th>èª¬æ˜</th>
                            <th>é »åº¦</th>
                            <th>è©³ç´°</th>
                        </tr>
                    </thead>
                    <tbody id="skillsTableBody">
                        <tr>
                            <td colspan="6" class="empty-state">
                                <h3>ğŸ“Š åˆ†æãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</h3>
                                <p>AIåˆ†æã‚’å®Ÿè¡Œã—ã¦ã‚¹ã‚­ãƒ«æƒ…å ±ã‚’è¡¨ç¤ºã—ã¾ã™</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- æ€è€ƒè»¸åˆ†æçµæœ -->
        <div class="analysis-section">
            <div class="section-header">
                <h2 class="section-title">
                    ğŸ§  æ€è€ƒè»¸åˆ†æçµæœ
                </h2>
            </div>
            
            <div id="thinkingTableContainer">
                <table class="data-table" id="thinkingTable">
                    <thead>
                        <tr>
                            <th>æ€è€ƒè»¸å</th>
                            <th>é »åº¦</th>
                            <th>å‰²åˆ</th>
                            <th>è¡Œå‹•ä¾‹</th>
                            <th>è©³ç´°</th>
                        </tr>
                    </thead>
                    <tbody id="thinkingTableBody">
                        <tr>
                            <td colspan="5" class="empty-state">
                                <h3>ğŸ§  åˆ†æãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</h3>
                                <p>AIåˆ†æã‚’å®Ÿè¡Œã—ã¦æ€è€ƒè»¸æƒ…å ±ã‚’è¡¨ç¤ºã—ã¾ã™</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <div class="mobile-menu" id="mobileMenu">
    </div>

    <!-- èª¬æ˜ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— -->
    <div class="popup-overlay" id="explanationPopup">
        <div class="popup-content">
            <div class="popup-header">
                <h3 class="popup-title" id="popupTitle">è©³ç´°èª¬æ˜</h3>
                <button class="popup-close" onclick="closeExplanationPopup()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="popup-body" id="popupBody">
                <!-- èª¬æ˜å†…å®¹ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
            </div>
        </div>
    </div>

    <script>
        // é…å»¶èªè¨¼ãƒã‚§ãƒƒã‚¯é–¢æ•°
        function checkAuthenticationDelayed() {
            const isAuthenticated = 
                sessionStorage.getItem('authenticated') === 'true' || 
                localStorage.getItem('authenticated') === 'true' ||
                (window.userManager && window.userManager.isLoggedIn());

            if (!isAuthenticated) {
                console.log('ğŸ”’ Authentication failed, redirecting to login...');
                window.location.href = 'index.html';
                return false;
            }
            
            console.log('âœ… Authentication check passed');
            return true;
        }

        // å³åº§ã®èªè¨¼ãƒã‚§ãƒƒã‚¯ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
        (function() {
            const isAuthenticated = 
                sessionStorage.getItem('authenticated') === 'true' || 
                localStorage.getItem('authenticated') === 'true';

            if (!isAuthenticated) {
                console.log('ğŸ”’ No authentication found, redirecting to login...');
                window.location.href = 'index.html';
                return;
            }
            
            console.log('âœ… Basic authentication check passed');
        })();

        // OpenAI APIã‚­ãƒ¼ï¼ˆå®Ÿéš›ã®ã‚­ãƒ¼ã«ç½®ãæ›ãˆã¦ãã ã•ã„ï¼‰
        const OPENAI_API_KEY = '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';
        
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let currentUser = '';
        let memoriesData = [];
        let analysisData = null;
        let isAnalyzing = false;
        let explanationsData = {};

        // DOMè¦ç´ 
        const statusIndicator = document.getElementById('statusIndicator');
        const exportBtn = document.getElementById('exportBtn');
        const startAnalysisBtn = document.getElementById('startAnalysisBtn');
        const skillsTableBody = document.getElementById('skillsTableBody');
        const thinkingTableBody = document.getElementById('thinkingTableBody');

        // ãƒšãƒ¼ã‚¸åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initializePage();
            loadExistingData();
        });

        // ç”»é¢ã‚µã‚¤ã‚ºå¤‰æ›´æ™‚ã«ãƒ†ãƒ¼ãƒ–ãƒ«è¡¨ç¤ºã‚’æ›´æ–°
        window.addEventListener('resize', function() {
            if (analysisData) {
                updateSkillsTable(analysisData.skills || []);
                updateThinkingTable(analysisData.thinking_patterns || []);
            }
        });

        // ãƒšãƒ¼ã‚¸åˆæœŸåŒ–
        function initializePage() {
            // èªè¨¼ãƒã‚§ãƒƒã‚¯ã‚’å…ˆã«å®Ÿè¡Œ
            if (!checkAuthenticationDelayed()) {
                return;
            }

            // ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ãƒã‚§ãƒƒã‚¯
            currentUser = localStorage.getItem('currentUser') || sessionStorage.getItem('username');
            if (!currentUser && window.userManager) {
                const user = window.userManager.getCurrentUser();
                if (user) {
                    currentUser = user.username;
                }
            }
            
            if (!currentUser) {
                console.log('ğŸ”’ No user found, redirecting...');
                window.location.href = 'index.html';
                return;
            }

            // ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’è¡¨ç¤º
            const usernameDisplay = document.getElementById('usernameDisplay');
            if (usernameDisplay) {
                usernameDisplay.textContent = currentUser;
            }

            // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
            exportBtn.addEventListener('click', exportAnalysisData);
            startAnalysisBtn.addEventListener('click', startAnalysis);

            updateStatus('info', 'ğŸ“Š åˆ†ææº–å‚™å®Œäº†ã€‚ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
            console.log('âœ… Page initialization complete');
        }

        // æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
        function loadExistingData() {
            try {
                // ãƒ¡ãƒ¢ãƒªãƒ¼ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
                const savedMemories = localStorage.getItem('ragme_memories');
                if (savedMemories) {
                    memoriesData = JSON.parse(savedMemories);
                    updateStatus('success', `ğŸ“š ãƒ¡ãƒ¢ãƒªãƒ¼ãƒ‡ãƒ¼ã‚¿ ${memoriesData.length}ä»¶ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ`);
                } else {
                    updateStatus('warning', 'âš ï¸ ãƒ¡ãƒ¢ãƒªãƒ¼ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ãƒ¡ãƒ¢ãƒªãƒ¼ãƒšãƒ¼ã‚¸ã§ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚');
                }

                // æ—¢å­˜ã®åˆ†æçµæœã®èª­ã¿è¾¼ã¿
                const savedAnalysis = localStorage.getItem('analysis_data');
                if (savedAnalysis) {
                    analysisData = JSON.parse(savedAnalysis);
                    displayAnalysisResults(analysisData);
                    enableExportButton();
                    updateStatus('success', 'âœ… ä¿å­˜æ¸ˆã¿ã®åˆ†æçµæœã‚’è¡¨ç¤ºã—ã¾ã—ãŸ');
                }

                // æ—¢å­˜ã®èª¬æ˜ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
                const savedExplanations = localStorage.getItem('explanations_data');
                if (savedExplanations) {
                    explanationsData = JSON.parse(savedExplanations);
                }
            } catch (error) {
                console.error('ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                updateStatus('error', 'âŒ ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
            }
        }

        // ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½
        function exportAnalysisData() {
            if (!analysisData) {
                updateStatus('warning', 'âš ï¸ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹åˆ†æãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“');
                return;
            }

            try {
                // JSONãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
                                 const exportData = {
                     timestamp: new Date().toISOString(),
                     user: currentUser,
                     skills: analysisData.skills || [],
                     thinking_patterns: analysisData.thinking_patterns || [],
                     explanations: explanationsData || {},
                     memories_count: memoriesData.length
                 };

                const dataStr = JSON.stringify(exportData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `ragme_analysis_${currentUser}_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);

                // CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚‚ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
                exportCSVData(analysisData);

                updateStatus('success', 'âœ… åˆ†æãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ');
            } catch (error) {
                console.error('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼:', error);
                updateStatus('error', 'âŒ ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        // CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½
        function exportCSVData(data) {
            try {
                // ã‚¹ã‚­ãƒ«ãƒ‡ãƒ¼ã‚¿ã®CSV
                const skillsCsv = convertSkillsToCSV(data.skills || []);
                const skillsBlob = new Blob([skillsCsv], { type: 'text/csv;charset=utf-8;' });
                
                const skillsLink = document.createElement('a');
                skillsLink.href = URL.createObjectURL(skillsBlob);
                skillsLink.download = `ragme_skills_${currentUser}_${new Date().toISOString().split('T')[0]}.csv`;
                document.body.appendChild(skillsLink);
                skillsLink.click();
                document.body.removeChild(skillsLink);

                // æ€è€ƒè»¸ãƒ‡ãƒ¼ã‚¿ã®CSV
                const thinkingCsv = convertThinkingToCSV(data.thinking_patterns || []);
                const thinkingBlob = new Blob([thinkingCsv], { type: 'text/csv;charset=utf-8;' });
                
                const thinkingLink = document.createElement('a');
                thinkingLink.href = URL.createObjectURL(thinkingBlob);
                thinkingLink.download = `ragme_thinking_${currentUser}_${new Date().toISOString().split('T')[0]}.csv`;
                document.body.appendChild(thinkingLink);
                thinkingLink.click();
                document.body.removeChild(thinkingLink);
            } catch (error) {
                console.error('CSV ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼:', error);
            }
        }

        // ã‚¹ã‚­ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’CSVã«å¤‰æ›
        function convertSkillsToCSV(skills) {
            const headers = ['ã‚¹ã‚­ãƒ«å', 'ãƒ¬ãƒ™ãƒ«', 'ã‚«ãƒ†ã‚´ãƒª', 'èª¬æ˜', 'é »åº¦', 'è©³ç´°èª¬æ˜'];
            const csvRows = [headers.join(',')];
            
            skills.forEach(skill => {
                const explanation = explanationsData[`skill_${skill.name}`] || '';
                const row = [
                    `"${skill.name}"`,
                    `"${getLevelText(skill.level)}"`,
                    `"${skill.category}"`,
                    `"${skill.description}"`,
                    skill.frequency,
                    `"${explanation.replace(/"/g, '""')}"`
                ];
                csvRows.push(row.join(','));
            });
            
            return csvRows.join('\n');
        }

        // æ€è€ƒè»¸ãƒ‡ãƒ¼ã‚¿ã‚’CSVã«å¤‰æ›
        function convertThinkingToCSV(patterns) {
            const headers = ['æ€è€ƒè»¸å', 'é »åº¦', 'å‰²åˆ', 'è¡Œå‹•ä¾‹', 'è©³ç´°èª¬æ˜'];
            const csvRows = [headers.join(',')];
            
            patterns.forEach(pattern => {
                const explanation = explanationsData[`thinking_${pattern.name}`] || '';
                const row = [
                    `"${pattern.name}"`,
                    pattern.frequency,
                    pattern.percentage,
                    `"${pattern.examples}"`,
                    `"${explanation.replace(/"/g, '""')}"`
                ];
                csvRows.push(row.join(','));
            });
            
            return csvRows.join('\n');
        }

        // ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒœã‚¿ãƒ³ã®æœ‰åŠ¹åŒ–
        function enableExportButton() {
            exportBtn.disabled = false;
            exportBtn.classList.remove('disabled');
        }

        // AIåˆ†æé–‹å§‹
        async function startAnalysis() {
            if (isAnalyzing) return;
            
            if (memoriesData.length === 0) {
                updateStatus('warning', 'âš ï¸ åˆ†æã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ãƒ¡ãƒ¢ãƒªãƒ¼ãƒšãƒ¼ã‚¸ã§ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            isAnalyzing = true;
            startAnalysisBtn.disabled = true;
            startAnalysisBtn.innerHTML = '<div class="loading"><div class="spinner"></div>åˆ†æä¸­...</div>';
            
            updateStatus('info', 'ğŸ¤– AIåˆ†æã‚’é–‹å§‹ã—ã¦ã„ã¾ã™...');

            try {
                let result;
                
                if (OPENAI_API_KEY && OPENAI_API_KEY !== 'YOUR_API_KEY_HERE') {
                    // GPT-3.5ã«ã‚ˆã‚‹åˆ†æ
                    result = await performGPTAnalysis();
                } else {
                    // ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã«ã‚ˆã‚‹åˆ†æ
                    result = performRuleBasedAnalysis();
                    updateStatus('warning', 'âš ï¸ APIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ãªã„ãŸã‚ã€ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹åˆ†æã‚’å®Ÿè¡Œã—ã¾ã—ãŸ');
                }

                // èª¬æ˜ã®ç”Ÿæˆ
                await generateExplanations(result);

                // çµæœã®ä¿å­˜ã¨è¡¨ç¤º
                localStorage.setItem('analysis_data', JSON.stringify(result));
                analysisData = result;
                displayAnalysisResults(result);
                enableExportButton();
                
                updateStatus('success', 'âœ… AIåˆ†æãŒå®Œäº†ã—ã¾ã—ãŸ');
                
            } catch (error) {
                console.error('åˆ†æã‚¨ãƒ©ãƒ¼:', error);
                updateStatus('error', 'âŒ åˆ†æä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
            } finally {
                isAnalyzing = false;
                startAnalysisBtn.disabled = false;
                startAnalysisBtn.innerHTML = 'ğŸ¤– GPT-3.5åˆ†æé–‹å§‹';
            }
        }

        // GPT-3.5ã«ã‚ˆã‚‹åˆ†æ
        async function performGPTAnalysis() {
            const prompt = `ä»¥ä¸‹ã®å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†æã—ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¹ã‚­ãƒ«ã¨æ€è€ƒè»¸ã‚’åŒ…æ‹¬çš„ã«æŠ½å‡ºã—ã¦ãã ã•ã„ã€‚
é »å‡ºã—ã¦ã„ãªã„ã‚¹ã‚­ãƒ«ã‚„æ€è€ƒè»¸ã‚‚å«ã‚ã€æœ€å¤§10é …ç›®ãšã¤åˆ†æã—ã¦ãã ã•ã„ã€‚
é »åº¦ãŒä½ã„ã‚‚ã®ã§ã‚‚é‡è¦ãªã‚¹ã‚­ãƒ«ã‚„æ€è€ƒãƒ‘ã‚¿ãƒ¼ãƒ³ã¯å«ã‚ã¦ãã ã•ã„ã€‚

å…¥åŠ›ãƒ‡ãƒ¼ã‚¿:
${memoriesData.map(memory => memory.content).join('\n\n')}

åˆ†æè¦³ç‚¹ï¼š
ã€ã‚¹ã‚­ãƒ«åˆ†æã€‘
- æŠ€è¡“ã‚¹ã‚­ãƒ«ï¼ˆãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã€AI/MLã€ãƒ‡ã‚¶ã‚¤ãƒ³ç­‰ï¼‰
- ãƒ“ã‚¸ãƒã‚¹ã‚¹ã‚­ãƒ«ï¼ˆãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆã€ä¼ç”»ã€å–¶æ¥­ã€ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°ç­‰ï¼‰
- èªå­¦ã‚¹ã‚­ãƒ«ï¼ˆè‹±èªã€ãã®ä»–è¨€èªï¼‰
- ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚­ãƒ«ï¼ˆãƒ—ãƒ¬ã‚¼ãƒ³ã€ä¼šè­°ã€ãƒãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ç­‰ï¼‰
- åˆ†æãƒ»å•é¡Œè§£æ±ºã‚¹ã‚­ãƒ«
- å‰µé€ æ€§ãƒ»ã‚¤ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³
- å­¦ç¿’èƒ½åŠ›ãƒ»é©å¿œåŠ›
- å°‚é–€çŸ¥è­˜ãƒ»æ¥­ç•ŒçŸ¥è­˜

ã€æ€è€ƒè»¸åˆ†æã€‘
- è«–ç†å‹æ€è€ƒï¼ˆåˆ†æçš„ã€ä½“ç³»çš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒï¼‰
- å‰µé€ å‹æ€è€ƒï¼ˆç™ºæƒ³åŠ›ã€ã‚¢ã‚¤ãƒ‡ã‚¢å‰µå‡ºï¼‰
- å®Ÿè·µå‹æ€è€ƒï¼ˆè¡Œå‹•é‡è¦–ã€å®Ÿè£…å¿—å‘ï¼‰
- å”èª¿å‹æ€è€ƒï¼ˆãƒãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã€åˆæ„å½¢æˆï¼‰
- å­¦ç¿’å‹æ€è€ƒï¼ˆçŸ¥è­˜å¸åã€æˆé•·å¿—å‘ï¼‰
- æˆ¦ç•¥å‹æ€è€ƒï¼ˆé•·æœŸè¦–ç‚¹ã€è¨ˆç”»ç«‹æ¡ˆï¼‰
- è©³ç´°å‹æ€è€ƒï¼ˆç²¾åº¦é‡è¦–ã€å®Œç’§ä¸»ç¾©ï¼‰
- é©æ–°å‹æ€è€ƒï¼ˆå¤‰é©å¿—å‘ã€æ–°ã—ã„æŒ‘æˆ¦ï¼‰
- é¡§å®¢å¿—å‘æ€è€ƒï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼é‡è¦–ã€ã‚µãƒ¼ãƒ“ã‚¹æ€è€ƒï¼‰
- åŠ¹ç‡å‹æ€è€ƒï¼ˆæœ€é©åŒ–ã€ç”Ÿç”£æ€§å‘ä¸Šï¼‰

ä»¥ä¸‹ã®JSONå½¢å¼ã§çµæœã‚’è¿”ã—ã¦ãã ã•ã„ï¼ˆæœ€å¤§å„10é …ç›®ï¼‰:
{
  "skills": [
    {
      "name": "ã‚¹ã‚­ãƒ«å",
      "level": "beginner|intermediate|advanced|expert",
      "category": "ã‚«ãƒ†ã‚´ãƒª",
      "description": "èª¬æ˜",
      "frequency": æ•°å€¤(1-100)
    }
  ],
  "thinking_patterns": [
    {
      "name": "æ€è€ƒè»¸å",
      "frequency": æ•°å€¤(1-100),
      "percentage": æ•°å€¤(0-100),
      "examples": "è¡Œå‹•ä¾‹"
    }
  ]
}`;

            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${OPENAI_API_KEY}`
                },
                body: JSON.stringify({
                    model: 'gpt-3.5-turbo',
                    messages: [{
                        role: 'user',
                        content: prompt
                    }],
                    max_tokens: 1500,
                    temperature: 0.7
                })
            });

            if (!response.ok) {
                throw new Error(`OpenAI API error: ${response.status}`);
            }

            const data = await response.json();
            const analysisResult = JSON.parse(data.choices[0].message.content);
            
            return analysisResult;
        }

        // ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹åˆ†æ
        function performRuleBasedAnalysis() {
            const skills = [];
            const thinkingPatterns = [];
            
            // åŒ…æ‹¬çš„ãªã‚¹ã‚­ãƒ«æ¤œå‡ºï¼ˆæœ€å¤§10é …ç›®ï¼‰
            const skillKeywords = {
                'ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°': ['react', 'javascript', 'ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°', 'ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ', 'hooks', 'ã‚³ãƒ¼ãƒ‰', 'ã‚¢ãƒ—ãƒª', 'ã‚·ã‚¹ãƒ†ãƒ '],
                'ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹': ['ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹', 'sql', 'ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹', 'æœ€é©åŒ–', 'db', 'ã‚¯ã‚¨ãƒª', 'ãƒ†ãƒ¼ãƒ–ãƒ«'],
                'ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆ': ['ãƒãƒ¼ãƒ ', 'ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°', 'é€²æ—', 'ã‚¿ã‚¹ã‚¯', 'ç®¡ç†', 'ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ', 'æŒ‡å°', 'ãƒªãƒ¼ãƒ€ãƒ¼'],
                'è‹±èªãƒ»èªå­¦': ['è‹±èª', 'english', 'ãƒ—ãƒ¬ã‚¼ãƒ³', 'ä¼šè©±', 'ãƒ“ã‚¸ãƒã‚¹', 'è¡¨ç¾', 'èªå­¦', 'ç¿»è¨³'],
                'ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°': ['ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°', 'é¡§å®¢', 'ãƒ‹ãƒ¼ã‚º', 'æˆ¦ç•¥', 'ãƒ¦ãƒ¼ã‚¶ãƒ¼', 'å¸‚å ´', 'å®£ä¼'],
                'ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³': ['ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³', 'ä¼šè©±', 'èª¬æ˜', 'ä¼ãˆã‚‹', 'å…±æœ‰', 'ç›¸è«‡', 'å¯¾è©±'],
                'åˆ†æãƒ»å•é¡Œè§£æ±º': ['åˆ†æ', 'è§£æ±º', 'èª²é¡Œ', 'å•é¡Œ', 'èª¿æŸ»', 'æ¤œè¨¼', 'æ”¹å–„', 'åŠ¹ç‡'],
                'å­¦ç¿’ãƒ»æˆé•·': ['å­¦ç¿’', 'å‹‰å¼·', 'ç¿’å¾—', 'ç†è§£', 'æˆé•·', 'å‘ä¸Š', 'ç·´ç¿’', 'ç ”ä¿®'],
                'ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ»UI': ['ãƒ‡ã‚¶ã‚¤ãƒ³', 'ui', 'ux', 'ç”»é¢', 'ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹', 'è¦‹ãŸç›®', 'ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ'],
                'ä¼ç”»ãƒ»æˆ¦ç•¥': ['ä¼ç”»', 'è¨ˆç”»', 'æˆ¦ç•¥', 'ã‚¢ã‚¤ãƒ‡ã‚¢', 'ææ¡ˆ', 'æ§‹æƒ³', 'è¨­è¨ˆ', 'ç«‹æ¡ˆ']
            };

            const allText = memoriesData.map(m => m.content.toLowerCase()).join(' ');
            
            // å…¨ã¦ã®ã‚¹ã‚­ãƒ«ã‚«ãƒ†ã‚´ãƒªã‚’ãƒã‚§ãƒƒã‚¯
            for (const [category, keywords] of Object.entries(skillKeywords)) {
                const matches = keywords.filter(keyword => allText.includes(keyword)).length;
                const keywordCount = keywords.length;
                const matchRate = matches / keywordCount;
                
                let frequency, level;
                if (matches === 0) {
                    // ãƒãƒƒãƒã—ãªã„å ´åˆã‚‚åŸºæœ¬é »åº¦ã‚’è¨­å®š
                    frequency = Math.floor(Math.random() * 15) + 5; // 5-20%ã®åŸºæœ¬é »åº¦
                    level = 'beginner';
                } else {
                    frequency = Math.min(Math.max(matches * 15 + Math.floor(Math.random() * 10), 20), 100);
                    level = matches >= 4 ? 'advanced' : matches >= 2 ? 'intermediate' : 'beginner';
                }
                
                skills.push({
                    name: category,
                    level: level,
                    category: 'æŠ€è¡“ãƒ»ãƒ“ã‚¸ãƒã‚¹',
                    description: `${category}ã«é–¢é€£ã™ã‚‹æ´»å‹•ã‚„çµŒé¨“`,
                    frequency: frequency
                });
            }

            // åŒ…æ‹¬çš„ãªæ€è€ƒãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ¤œå‡ºï¼ˆæœ€å¤§10é …ç›®ï¼‰
            const thinkingKeywords = {
                'è«–ç†å‹æ€è€ƒ': ['åˆ†æ', 'ç†è§£', 'æ•´ç†', 'è§£æ±º', 'æœ€é©åŒ–', 'ä½“ç³»çš„', 'è«–ç†', 'ç†è«–'],
                'å®Ÿè·µå‹æ€è€ƒ': ['å®Ÿéš›ã«', 'ä½¿ã£ã¦', 'è©¦ã—ã¦', 'å®Ÿè¡Œ', 'å®Ÿè·µ', 'è¡Œå‹•', 'å®Ÿè£…', 'å…·ä½“çš„'],
                'å­¦ç¿’å‹æ€è€ƒ': ['å­¦ç¿’', 'è¦šãˆã¦', 'ç†è§£ã§ãã‚‹', 'å‹‰å¼·', 'ç·´ç¿’', 'ç¿’å¾—', 'å‘ä¸Š', 'æˆé•·'],
                'å”èª¿å‹æ€è€ƒ': ['ãƒãƒ¼ãƒ ', 'ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°', 'åˆ†æ‹…', 'ä¼šè­°', 'å”åŠ›', 'é€£æº', 'å…±æœ‰', 'ç›¸è«‡'],
                'å‰µé€ å‹æ€è€ƒ': ['æ–°ã—ã„', 'æˆ¦ç•¥', 'è¨­è¨ˆ', 'å‰µé€ ', 'ã‚¢ã‚¤ãƒ‡ã‚¢', 'ç™ºæƒ³', 'é©æ–°', 'å·¥å¤«'],
                'åŠ¹ç‡å‹æ€è€ƒ': ['åŠ¹ç‡', 'æœ€é©åŒ–', 'æ”¹å–„', 'ç”Ÿç”£æ€§', 'æ™‚é–“', 'ç°¡å˜', 'æ—©ã', 'åˆç†'],
                'è©³ç´°å‹æ€è€ƒ': ['è©³ç´°', 'æ­£ç¢º', 'ä¸å¯§', 'æ…é‡', 'ç¢ºèª', 'æ¤œè¨¼', 'å“è³ª', 'ç²¾å¯†'],
                'æˆ¦ç•¥å‹æ€è€ƒ': ['æˆ¦ç•¥', 'è¨ˆç”»', 'å°†æ¥', 'é•·æœŸ', 'ç›®æ¨™', 'æ–¹é‡', 'æ§‹æƒ³', 'ä¼ç”»'],
                'é¡§å®¢å¿—å‘æ€è€ƒ': ['é¡§å®¢', 'ãƒ¦ãƒ¼ã‚¶ãƒ¼', 'ã‚µãƒ¼ãƒ“ã‚¹', 'ãƒ‹ãƒ¼ã‚º', 'è¦æ±‚', 'æº€è¶³', 'ä½“é¨“'],
                'é©æ–°å‹æ€è€ƒ': ['é©æ–°', 'å¤‰é©', 'æŒ‘æˆ¦', 'æ–°è¦', 'å¤‰åŒ–', 'æ”¹é©', 'å…ˆé€²', 'æ–¬æ–°']
            };

            // å…¨ã¦ã®æ€è€ƒè»¸ã‚’ãƒã‚§ãƒƒã‚¯
            for (const [pattern, keywords] of Object.entries(thinkingKeywords)) {
                const matches = keywords.filter(keyword => allText.includes(keyword)).length;
                const keywordCount = keywords.length;
                
                let frequency;
                if (matches === 0) {
                    // ãƒãƒƒãƒã—ãªã„å ´åˆã‚‚åŸºæœ¬é »åº¦ã‚’è¨­å®š
                    frequency = Math.floor(Math.random() * 20) + 10; // 10-30%ã®åŸºæœ¬é »åº¦
                } else {
                    frequency = Math.min(Math.max(matches * 12 + Math.floor(Math.random() * 15), 25), 100);
                }
                
                thinkingPatterns.push({
                    name: pattern,
                    frequency: frequency,
                    percentage: Math.round(frequency * 0.8 + Math.random() * 10),
                    examples: `${pattern}ã«é–¢é€£ã™ã‚‹æ´»å‹•ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚„è¡¨ç¾`
                });
            }

            // é »åº¦é †ã«ã‚½ãƒ¼ãƒˆ
            skills.sort((a, b) => b.frequency - a.frequency);
            thinkingPatterns.sort((a, b) => b.frequency - a.frequency);

            return {
                skills: skills,
                thinking_patterns: thinkingPatterns
            };
        }

        // åˆ†æçµæœã®è¡¨ç¤º
        function displayAnalysisResults(data) {
            updateSkillsTable(data.skills || []);
            updateThinkingTable(data.thinking_patterns || []);
        }

        // ã‚¹ã‚­ãƒ«ãƒ†ãƒ¼ãƒ–ãƒ«ã®æ›´æ–°
        function updateSkillsTable(skills) {
            if (skills.length === 0) {
                skillsTableBody.innerHTML = `
                    <tr>
                        <td colspan="6" class="empty-state">
                            <h3>ğŸ“Š ã‚¹ã‚­ãƒ«ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</h3>
                            <p>åˆ†æã‚’å®Ÿè¡Œã—ã¦ã‚¹ã‚­ãƒ«æƒ…å ±ã‚’è¡¨ç¤ºã—ã¾ã™</p>
                        </td>
                    </tr>
                `;
                return;
            }

            // ãƒ¢ãƒã‚¤ãƒ«å‘ã‘ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¿½åŠ 
            const mobileHeader = window.innerWidth <= 375 ? 
                '<div class="mobile-table-header">ã‚¹ã‚­ãƒ«å | ãƒ¬ãƒ™ãƒ« | è©³ç´°</div>' : '';
            
            const tableContent = skills.map(skill => `
                <tr class="fade-in">
                    <td><strong>${escapeHtml(skill.name)}</strong></td>
                    <td><span class="skill-level level-${skill.level}">${getLevelText(skill.level)}</span></td>
                    <td>${escapeHtml(skill.category)}</td>
                    <td>${escapeHtml(skill.description)}</td>
                    <td>${skill.frequency}%</td>
                    <td>
                        <button class="explain-btn" onclick="showExplanation('skill', '${escapeHtml(skill.name)}')">
                            è©³ç´°
                        </button>
                    </td>
                </tr>
            `).join('');

            skillsTableBody.innerHTML = tableContent;
            
            // ãƒ¢ãƒã‚¤ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¡¨ç¤ºã‚¨ãƒªã‚¢ã®å‰ã«æŒ¿å…¥
            if (window.innerWidth <= 375) {
                const container = document.getElementById('skillsTableContainer');
                const existingHeader = container.querySelector('.mobile-table-header');
                if (existingHeader) {
                    existingHeader.remove();
                }
                container.insertAdjacentHTML('afterbegin', mobileHeader);
            }
        }

        // æ€è€ƒè»¸ãƒ†ãƒ¼ãƒ–ãƒ«ã®æ›´æ–°
        function updateThinkingTable(patterns) {
            if (patterns.length === 0) {
                thinkingTableBody.innerHTML = `
                    <tr>
                        <td colspan="5" class="empty-state">
                            <h3>ğŸ§  æ€è€ƒè»¸ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</h3>
                            <p>åˆ†æã‚’å®Ÿè¡Œã—ã¦æ€è€ƒè»¸æƒ…å ±ã‚’è¡¨ç¤ºã—ã¾ã™</p>
                        </td>
                    </tr>
                `;
                return;
            }

            // ãƒ¢ãƒã‚¤ãƒ«å‘ã‘ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¿½åŠ 
            const mobileHeader = window.innerWidth <= 375 ? 
                '<div class="mobile-table-header">æ€è€ƒè»¸å | é »åº¦ | è©³ç´°</div>' : '';

            const tableContent = patterns.map(pattern => `
                <tr class="fade-in">
                    <td><strong>${escapeHtml(pattern.name)}</strong></td>
                    <td>
                        <div class="thinking-frequency">
                            <div class="frequency-bar">
                                <div class="frequency-fill" style="width: ${pattern.frequency}%"></div>
                            </div>
                            <span>${pattern.frequency}%</span>
                        </div>
                    </td>
                    <td>${pattern.percentage}%</td>
                    <td>${escapeHtml(pattern.examples)}</td>
                    <td>
                        <button class="explain-btn" onclick="showExplanation('thinking', '${escapeHtml(pattern.name)}')">
                            è©³ç´°
                        </button>
                    </td>
                </tr>
            `).join('');

            thinkingTableBody.innerHTML = tableContent;
            
            // ãƒ¢ãƒã‚¤ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¡¨ç¤ºã‚¨ãƒªã‚¢ã®å‰ã«æŒ¿å…¥
            if (window.innerWidth <= 375) {
                const container = document.getElementById('thinkingTableContainer');
                const existingHeader = container.querySelector('.mobile-table-header');
                if (existingHeader) {
                    existingHeader.remove();
                }
                container.insertAdjacentHTML('afterbegin', mobileHeader);
            }
        }

        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
        function updateStatus(type, message) {
            statusIndicator.className = `status-indicator status-${type}`;
            statusIndicator.textContent = message;
        }

        // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
        function getLevelText(level) {
            const levels = {
                beginner: 'åˆå¿ƒè€…',
                intermediate: 'ä¸­ç´šè€…',
                advanced: 'ä¸Šç´šè€…',
                expert: 'ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆ'
            };
            return levels[level] || level;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // èª¬æ˜ç”Ÿæˆæ©Ÿèƒ½
        async function generateExplanations(data) {
            updateStatus('info', 'ğŸ¤– è©³ç´°èª¬æ˜ã‚’ç”Ÿæˆã—ã¦ã„ã¾ã™...');
            
            try {
                // ã‚¹ã‚­ãƒ«ã®èª¬æ˜ç”Ÿæˆ
                for (const skill of data.skills || []) {
                    const key = `skill_${skill.name}`;
                    if (!explanationsData[key]) {
                        if (OPENAI_API_KEY && OPENAI_API_KEY !== 'YOUR_API_KEY_HERE') {
                            explanationsData[key] = await generateGPTExplanation('skill', skill);
                        } else {
                            explanationsData[key] = generateRuleBasedExplanation('skill', skill);
                        }
                    }
                }

                // æ€è€ƒè»¸ã®èª¬æ˜ç”Ÿæˆ
                for (const pattern of data.thinking_patterns || []) {
                    const key = `thinking_${pattern.name}`;
                    if (!explanationsData[key]) {
                        if (OPENAI_API_KEY && OPENAI_API_KEY !== 'YOUR_API_KEY_HERE') {
                            explanationsData[key] = await generateGPTExplanation('thinking', pattern);
                        } else {
                            explanationsData[key] = generateRuleBasedExplanation('thinking', pattern);
                        }
                    }
                }

                // èª¬æ˜ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜
                localStorage.setItem('explanations_data', JSON.stringify(explanationsData));
                
            } catch (error) {
                console.error('èª¬æ˜ç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error);
            }
        }

        // GPTã«ã‚ˆã‚‹èª¬æ˜ç”Ÿæˆ
        async function generateGPTExplanation(type, item) {
            const prompt = type === 'skill' 
                ? `ä»¥ä¸‹ã®ã‚¹ã‚­ãƒ«åˆ†æçµæœã«ã¤ã„ã¦ã€ãªãœã“ã®ã‚ˆã†ãªçµæœã«ãªã£ãŸã®ã‹ã‚’è©³ã—ãèª¬æ˜ã—ã¦ãã ã•ã„ï¼š

ã‚¹ã‚­ãƒ«å: ${item.name}
ãƒ¬ãƒ™ãƒ«: ${getLevelText(item.level)}
ã‚«ãƒ†ã‚´ãƒª: ${item.category}
é »åº¦: ${item.frequency}%

åˆ†æå¯¾è±¡ã®ãƒ‡ãƒ¼ã‚¿:
${memoriesData.map(memory => memory.content).join('\n\n')}

ä»¥ä¸‹ã®è¦³ç‚¹ã‹ã‚‰èª¬æ˜ã—ã¦ãã ã•ã„ï¼š
1. ã“ã®ã‚¹ã‚­ãƒ«ãŒæ¤œå‡ºã•ã‚ŒãŸç†ç”±
2. ãƒ¬ãƒ™ãƒ«åˆ¤å®šã®æ ¹æ‹ 
3. é »åº¦ã‚¹ã‚³ã‚¢ã®ç®—å‡ºæ–¹æ³•
4. ä»Šå¾Œã®æˆé•·ã«å‘ã‘ãŸã‚¢ãƒ‰ãƒã‚¤ã‚¹`
                : `ä»¥ä¸‹ã®æ€è€ƒè»¸åˆ†æçµæœã«ã¤ã„ã¦ã€ãªãœã“ã®ã‚ˆã†ãªçµæœã«ãªã£ãŸã®ã‹ã‚’è©³ã—ãèª¬æ˜ã—ã¦ãã ã•ã„ï¼š

æ€è€ƒè»¸å: ${item.name}
é »åº¦: ${item.frequency}%
å‰²åˆ: ${item.percentage}%

åˆ†æå¯¾è±¡ã®ãƒ‡ãƒ¼ã‚¿:
${memoriesData.map(memory => memory.content).join('\n\n')}

ä»¥ä¸‹ã®è¦³ç‚¹ã‹ã‚‰èª¬æ˜ã—ã¦ãã ã•ã„ï¼š
1. ã“ã®æ€è€ƒè»¸ãŒæ¤œå‡ºã•ã‚ŒãŸç†ç”±
2. é »åº¦ã¨å‰²åˆã®ç®—å‡ºæ–¹æ³•
3. å…·ä½“çš„ãªè¡Œå‹•ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ä¾‹
4. ã“ã®æ€è€ƒè»¸ã®ç‰¹å¾´ã¨å¼·ã¿`;

            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${OPENAI_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-3.5-turbo',
                        messages: [{
                            role: 'user',
                            content: prompt
                        }],
                        max_tokens: 800,
                        temperature: 0.7
                    })
                });

                if (!response.ok) {
                    throw new Error(`OpenAI API error: ${response.status}`);
                }

                const data = await response.json();
                return data.choices[0].message.content;
            } catch (error) {
                console.error('GPTèª¬æ˜ç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error);
                return generateRuleBasedExplanation(type, item);
            }
        }

        // ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã®èª¬æ˜ç”Ÿæˆ
        function generateRuleBasedExplanation(type, item) {
            if (type === 'skill') {
                return `<h4>ğŸ¯ ã‚¹ã‚­ãƒ«æ¤œå‡ºã®ç†ç”±</h4>
<p>ã€Œ${item.name}ã€ã«é–¢é€£ã™ã‚‹ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚„æ´»å‹•ãŒãƒ¡ãƒ¢ãƒªãƒ¼ãƒ‡ãƒ¼ã‚¿å†…ã§æ¤œå‡ºã•ã‚Œã¾ã—ãŸã€‚</p>

<h4>ğŸ“Š ãƒ¬ãƒ™ãƒ«åˆ¤å®šã®æ ¹æ‹ </h4>
<p><strong>${getLevelText(item.level)}</strong>ãƒ¬ãƒ™ãƒ«ã¨åˆ¤å®šã•ã‚ŒãŸç†ç”±ï¼š</p>
<ul>
    <li>é–¢é€£ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã®å‡ºç¾é »åº¦: ${item.frequency}%</li>
    <li>æ´»å‹•å†…å®¹ã®å°‚é–€æ€§ã‚„è¤‡é›‘ã•</li>
    <li>å®Ÿè·µçš„ãªçµŒé¨“ã‚„æˆæœã®è¨˜è¿°</li>
</ul>

<h4>ğŸš€ æˆé•·ã«å‘ã‘ãŸã‚¢ãƒ‰ãƒã‚¤ã‚¹</h4>
<p>ã“ã®ã‚¹ã‚­ãƒ«ã‚’ã•ã‚‰ã«å‘ä¸Šã•ã›ã‚‹ãŸã‚ã«ã€ç¶™ç¶šçš„ãªå­¦ç¿’ã¨å®Ÿè·µã‚’å¿ƒãŒã‘ã¾ã—ã‚‡ã†ã€‚</p>`;
            } else {
                return `<h4>ğŸ§  æ€è€ƒè»¸æ¤œå‡ºã®ç†ç”±</h4>
<p>ã€Œ${item.name}ã€ã«é–¢é€£ã™ã‚‹æ€è€ƒãƒ‘ã‚¿ãƒ¼ãƒ³ã‚„è¡Œå‹•ãŒãƒ¡ãƒ¢ãƒªãƒ¼ãƒ‡ãƒ¼ã‚¿å†…ã§ç¢ºèªã•ã‚Œã¾ã—ãŸã€‚</p>

<h4>ğŸ“ˆ é »åº¦ç®—å‡ºã®æ–¹æ³•</h4>
<p>é–¢é€£ã™ã‚‹è¡Œå‹•ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚„è¡¨ç¾ã®å‡ºç¾é »åº¦ã‚’åˆ†æã—ã€${item.frequency}%ã¨ã„ã†çµæœã«ãªã‚Šã¾ã—ãŸã€‚</p>

<h4>ğŸ’¡ ã“ã®æ€è€ƒè»¸ã®ç‰¹å¾´</h4>
<p>ã‚ãªãŸã®æ€è€ƒã‚„è¡Œå‹•ã®ä¸­ã§ã€Œ${item.name}ã€çš„ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒãŒè¦‹ã‚‰ã‚Œã€ã“ã‚Œã¯é‡è¦ãªå¼·ã¿ã®ä¸€ã¤ã§ã™ã€‚</p>

<h4>ğŸŒŸ æ´»ç”¨æ–¹æ³•</h4>
<p>ã“ã®æ€è€ƒè»¸ã‚’æ„è­˜çš„ã«æ´»ç”¨ã™ã‚‹ã“ã¨ã§ã€ã‚ˆã‚ŠåŠ¹æœçš„ãªå•é¡Œè§£æ±ºã‚„æ„æ€æ±ºå®šãŒã§ãã‚‹ã§ã—ã‚‡ã†ã€‚</p>`;
            }
        }

        // èª¬æ˜ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¡¨ç¤º
        function showExplanation(type, name) {
            const key = `${type}_${name}`;
            const explanation = explanationsData[key];
            
            // åŸºæœ¬æƒ…å ±ã‚’å–å¾—
            let basicInfo = '';
            if (type === 'skill' && analysisData && analysisData.skills) {
                const skill = analysisData.skills.find(s => s.name === name);
                if (skill) {
                    basicInfo = `
                        <div style="background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                            <h4>ğŸ“Š åŸºæœ¬æƒ…å ±</h4>
                            <ul>
                                <li><strong>ã‚¹ã‚­ãƒ«å:</strong> ${escapeHtml(skill.name)}</li>
                                <li><strong>ãƒ¬ãƒ™ãƒ«:</strong> ${getLevelText(skill.level)}</li>
                                <li><strong>ã‚«ãƒ†ã‚´ãƒª:</strong> ${escapeHtml(skill.category)}</li>
                                <li><strong>é »åº¦:</strong> ${skill.frequency}%</li>
                                <li><strong>èª¬æ˜:</strong> ${escapeHtml(skill.description)}</li>
                            </ul>
                        </div>
                    `;
                }
            } else if (type === 'thinking' && analysisData && analysisData.thinking_patterns) {
                const pattern = analysisData.thinking_patterns.find(p => p.name === name);
                if (pattern) {
                    basicInfo = `
                        <div style="background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                            <h4>ğŸ“Š åŸºæœ¬æƒ…å ±</h4>
                            <ul>
                                <li><strong>æ€è€ƒè»¸å:</strong> ${escapeHtml(pattern.name)}</li>
                                <li><strong>é »åº¦:</strong> ${pattern.frequency}%</li>
                                <li><strong>å‰²åˆ:</strong> ${pattern.percentage}%</li>
                                <li><strong>è¡Œå‹•ä¾‹:</strong> ${escapeHtml(pattern.examples)}</li>
                            </ul>
                        </div>
                    `;
                }
            }
            
            const detailedExplanation = explanation || generateRuleBasedExplanation(type, { name });

            document.getElementById('popupTitle').innerHTML = `
                ${type === 'skill' ? 'ğŸ’¡' : 'ğŸ§ '} ${escapeHtml(name)}
            `;
            document.getElementById('popupBody').innerHTML = basicInfo + detailedExplanation;
            document.getElementById('explanationPopup').classList.add('show');
        }

        // èª¬æ˜ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—é–‰ã˜ã‚‹
        function closeExplanationPopup() {
            document.getElementById('explanationPopup').classList.remove('show');
        }

        // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
        document.getElementById('explanationPopup').addEventListener('click', function(e) {
            if (e.target === this) {
                closeExplanationPopup();
            }
        });

        // ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®åˆ¶å¾¡
        function toggleMobileMenu() {
            const navMenu = document.getElementById('navMenu');
            const hamburgerMenu = document.getElementById('hamburgerMenu');
            
            navMenu.classList.toggle('active');
            hamburgerMenu.classList.toggle('active');
        }

        // ãƒ¡ãƒ‹ãƒ¥ãƒ¼å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
        document.addEventListener('click', function(e) {
            const navMenu = document.getElementById('navMenu');
            const hamburgerMenu = document.getElementById('hamburgerMenu');
            
            if (!hamburgerMenu.contains(e.target) && !navMenu.contains(e.target)) {
                navMenu.classList.remove('active');
                hamburgerMenu.classList.remove('active');
            }
        });

        // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒªãƒ³ã‚¯ã‚¯ãƒªãƒƒã‚¯æ™‚ã«ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‰ã˜ã‚‹
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function() {
                const navMenu = document.getElementById('navMenu');
                const hamburgerMenu = document.getElementById('hamburgerMenu');
                navMenu.classList.remove('active');
                hamburgerMenu.classList.remove('active');
            });
        });

        function logoutUser() {
            console.log('ğŸ”’ Logging out...');
            
            // UserManagerã®ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
            if (window.userManager) {
                window.userManager.logout();
            }
            
            // ã‚»ãƒƒã‚·ãƒ§ãƒ³æƒ…å ±ã‚’ã‚¯ãƒªã‚¢
            sessionStorage.removeItem('authenticated');
            sessionStorage.removeItem('username');
            localStorage.removeItem('authenticated');
            localStorage.removeItem('username');
            localStorage.removeItem('currentUser');
            
            // ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
            window.location.href = 'index.html';
        }
    </script>
</body>
</html>
